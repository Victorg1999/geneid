% -*- mode: Noweb; noweb-code-mode: perl-mode; tab-width: 4 -*-
\documentclass[11pt]{article}
%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8
%
% # $Id: maskedfastacoords.tex,v 1.1 2001-09-06 18:27:09 jabril Exp $ 
%
\usepackage{noweb}
\usepackage[a4paper,offset={0pt,0pt},hmargin={2cm,2cm},vmargin={1cm,1cm}]{geometry}
\usepackage{graphics}
\usepackage[dvips]{graphicx}
%% pstricks
\usepackage[dvips]{pstcol}
\usepackage{pstricks}
%\usepackage{pst-node}
%\usepackage{pst-char}
%\usepackage{pst-grad}
%% bibliography
\usepackage{natbib}
%% latex2html
\usepackage{url}
\usepackage{html}     
\usepackage{htmllist} 
%% tables    
\usepackage{dcolumn}
%\usepackage{colortbl}
%\usepackage{multirow}
%\usepackage{hhline}
%\usepackage{tabularx}
%% seminar
%\usepackage{semcolor,semlayer,semrot,semhelv,sem-page,slidesec}
%% draft watermark
%\usepackage[all,dvips]{draftcopy}
%\draftcopySetGrey{0.9}
%\draftcopyName{CONFIDENTIAL}{100}
%% layout
\usepackage{fancyhdr} % Do not use \usepackage{fancybox} -> TOCs disappear
%\usepackage{lscape}
%\usepackage{rotating}
%\usepackage{multicol}
%% fonts
\usepackage{times}\fontfamily{ptm}\selectfont
\usepackage{t1enc}

% noweb options
\noweboptions{smallcode}
\def\nwendcode{\endtrivlist \endgroup} % relax page breaking scheme
\let\nwdocspar=\par                    %

\input defs.tex % from <LaTeX new definitions> chunk

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\begin{document}
%
\nwfilename{/home/ug/jabril/development/softjabril/maskedfastacoords/maskedfastacoords.nw}%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
\nwbegindocs{2}\nwdocspar

\nwenddocs{}%
\nwbegindocs{4}\nwdocspar
\nwenddocs{}%
\nwbegindocs{6}\nwdocspar
\nwenddocs{}%
\nwbegindocs{8}\nwdocspar
\nwenddocs{}%
\nwbegindocs{10}\nwdocspar

\thispagestyle{empty}

\begin{titlepage}

\ \vfill
\begin{center}
\begin{bfseries}
\begin{large}
\newlength{\lttbl}\setlength{\lttbl}{0.25\linewidth}
\newlength{\rttbl}\setlength{\rttbl}{0.70\linewidth}
%\fbox{
%\vskip 2ex
\begin{tabular}{>{\scshape}r@{\quad}l}
\rule{\lttbl}{0pt} & \rule{\rttbl}{0pt} \\[2ex]
\multicolumn{2}{c}{\shortstack{\rule[0ex]{0.95\linewidth}{2pt}\\[0ex]
                               \rule[1ex]{0.95\linewidth}{2pt}}}\\[2ex]
Program Name: & {\Huge\progname}                       \\[3ex]
\multicolumn{2}{c}{\rule[0.5ex]{0.95\linewidth}{2pt}}\\[2ex]
      Author: & {\Large
                 \begin{minipage}[t]{0.95\rttbl}
                 \authorslist
                 \end{minipage}}                       \\[2ex]
     License: & {\license}                             \\[2ex]
 Last Update: & {\today}                               \\[2ex]
 Description: & {\large\mdseries
                 \begin{minipage}[t]{0.95\rttbl}
                 \description
                 \end{minipage}}                       \\[2ex]
\\
\multicolumn{2}{c}{\shortstack{\rule[0ex]{0.95\linewidth}{2pt}\\[0ex]
                               \rule[1ex]{0.95\linewidth}{2pt}}}\\[2ex]
\end{tabular}
%} % fbox
\end{large}
\end{bfseries}
\end{center}

\vfill

\begin{raggedleft}
\showaffiliation
\end{raggedleft}

\end{titlepage} %'

%
%%%%%%%%%%%%%%%%%%%% FRONTMATTER

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pagenumbering{roman}
\setcounter{page}{1}
\pagestyle{fancy}
% Marks redefinition must go here because pagestyle 
% resets the values to the default ones.
\renewcommand{\sectionmark}[1]{\markboth{}{\thesection.\ #1}}
\renewcommand{\subsectionmark}[1]{\markboth{}{\thesubsection.\ \textsl{#1}}}

\tableofcontents
\listoftables
\listoffigures

\vfill
\begin{center}
{\small$<$ \verb$Id: maskedfastacoords.tex,v 1.1 2001-09-06 18:27:09 jabril Exp $$>$ }
\end{center}

%%%%%%%%%%%%%%%%%%%% MAINMATTER

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pagenumbering{arabic}
\setcounter{page}{1}

\sctn{Introduction}

\subsctn{Program description}

\subsctn{Input}

\subsctn{Output}

% \subsctn{Comments}

\subsctn{To Do}

\begin{itemize}
 \input todo.tex
\end{itemize}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\sctn{Implementation}

\subsctn{Program outline}

\nwenddocs{}\nwbegincode{11}\sublabel{NWmas1F-masH-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-masH-1}}}\moddef{maskedfastacoords~{\nwtagstyle{}\subpageref{NWmas1F-masH-1}}}\endmoddef
\LA{}PERL shebang~{\nwtagstyle{}\subpageref{NWmas1F-PERC-1}}\RA{}
#
# MODULES
#
\LA{}Use Modules~{\nwtagstyle{}\subpageref{NWmas1F-UseB-1}}\RA{}
#
# VARIABLES
#
\LA{}Global Vars~{\nwtagstyle{}\subpageref{NWmas1F-GloB-1}}\RA{}
#
# MAIN LOOP
#
\LA{}Main Loop~{\nwtagstyle{}\subpageref{NWmas1F-Mai9-1}}\RA{}
#
# FUNCTIONS
#
\LA{}Functions~{\nwtagstyle{}\subpageref{NWmas1F-Fun9-1}}\RA{}
\nwnotused{maskedfastacoords}\nwendcode{}\nwbegindocs{12}\nwdocspar

\nwenddocs{}\nwbegincode{13}\sublabel{NWmas1F-UseB-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-UseB-1}}}\moddef{Use Modules~{\nwtagstyle{}\subpageref{NWmas1F-UseB-1}}}\endmoddef
\nwused{\\{NWmas1F-masH-1}}\nwendcode{}\nwbegindocs{14}\nwdocspar

\nwenddocs{}\nwbegincode{15}\sublabel{NWmas1F-GloB-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-GloB-1}}}\moddef{Global Vars~{\nwtagstyle{}\subpageref{NWmas1F-GloB-1}}}\endmoddef
\nwused{\\{NWmas1F-masH-1}}\nwendcode{}\nwbegindocs{16}\nwdocspar

\nwenddocs{}\nwbegincode{17}\sublabel{NWmas1F-Mai9-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-Mai9-1}}}\moddef{Main Loop~{\nwtagstyle{}\subpageref{NWmas1F-Mai9-1}}}\endmoddef

exit(0);
\nwused{\\{NWmas1F-masH-1}}\nwendcode{}\nwbegindocs{18}\nwdocspar

\nwenddocs{}\nwbegincode{19}\sublabel{NWmas1F-Fun9-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-Fun9-1}}}\moddef{Functions~{\nwtagstyle{}\subpageref{NWmas1F-Fun9-1}}}\endmoddef
sub \{
\} # 
\nwused{\\{NWmas1F-masH-1}}\nwendcode{}\nwbegindocs{20}\nwdocspar

\label{todo:AAA}
\nwenddocs{}%
%
\nwbegindocs{22}\nwdocspar
\nwenddocs{}%
%
\nwbegindocs{24}\nwdocspar
\todo{ \item \todoAAA } % todo

\nwenddocs{}\nwbegincode{25}\sublabel{NWmas1F-OLDI-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-OLDI-1}}}\moddef{OLD IMPLEMENTATION~{\nwtagstyle{}\subpageref{NWmas1F-OLDI-1}}}\endmoddef
#
# getfastamasked.pl < fastafile > GFFfile
#
#     Retrieving masked regions coords from fasta files
#
use Bio::Seq;
use Bio::SeqIO;
\LA{}Use Modules - Benchmark~{\nwtagstyle{}\subpageref{NWmas1F-UseN-1}}\RA{}
my $PROGRAM = 'getfastamasked.pl';
my ($T,$F) = (1,0);
my $DATE = localtime;
my $USER = defined($ENV\{USER\}) ? $ENV\{USER\} : '??????';
my $host = `hostname`;
chomp($host);
my $line = ('#' x 80)."\\n";
my $s = '### ';
#
my ($id,$seq) = ('','');
my ($total_time);

print STDERR << "+++EOR+++";
$line$s\\n$s Running $PROGRAM\\n$s
$s HOST: $host
$s USER: $USER
$s DATE: $DATE\\n$s\\n$line$s
+++EOR+++

&main();

$total_time = &timing($T);
print STDERR << "+++EOR+++";
$s\\n$line$s\\n$s $PROGRAM FINISHED\\n$s
$s TOTAL TIME: $total_time\\n$line
+++EOR+++

exit(0);

sub main() \{
    my $seqin = Bio::SeqIO->new(-format => 'FASTA', -fh => \\*STDIN);
    while (my $sequence = $seqin->next_seq()) \{
        my ($sid,$len,$seq,@nuc,@coords,$masked_flg,$match,$msk_num);
        @coords = ();
        \LA{}Setting sequence variables from fasta record~{\nwtagstyle{}\subpageref{NWmas1F-Seti-1}}\RA{}
        \LA{}Finding masked regions coords~{\nwtagstyle{}\subpageref{NWmas1F-FinT-1}}\RA{}
        \LA{}Writing masked regions coords in GFF~{\nwtagstyle{}\subpageref{NWmas1F-Wria-1}}\RA{}
    \}; # while 
\} # main
\LA{}Common PERL subs - Benchmark~{\nwtagstyle{}\subpageref{NWmas1F-ComS-1}}\RA{}
\nwnotused{OLD\ IMPLEMENTATION}\nwendcode{}\nwbegindocs{26}\nwdocspar

\nwenddocs{}\nwbegincode{27}\sublabel{NWmas1F-Seti-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-Seti-1}}}\moddef{Setting sequence variables from fasta record~{\nwtagstyle{}\subpageref{NWmas1F-Seti-1}}}\endmoddef
print STDERR "### READING FASTA............\\n";
$sid  = $sequence->display_id();
$len  = $sequence->length();
$seq  = $sequence->seq();
\nwused{\\{NWmas1F-OLDI-1}}\nwendcode{}\nwbegindocs{28}\nwdocspar

\nwenddocs{}\nwbegincode{29}\sublabel{NWmas1F-FinT-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-FinT-1}}}\moddef{Finding masked regions coords~{\nwtagstyle{}\subpageref{NWmas1F-FinT-1}}}\endmoddef
print STDERR "###         PARSING SEQUENCE: $sid ($len bp)\\n";
@nuc = split //og, $seq;
($masked_flg,$match) = ($F,$F) ;
for (my $n = 0; $n <= $#nuc; $n++) \{
    $match = ( $nuc[$n] =~ /[NnXx]/o ) ? $T : $F;
    ( !$masked_flg && $match ) && do \{
        $masked_flg = $T ;
        # $n contains the last non-masked nucleotide
        push @coords, ($n + 1);
        next;
    \};
    $masked_flg && do \{
        $match && (next);
        $masked_flg = $F ;
        # $n contains the last masked nucleotide now
        push @coords, $n;
    \};
\}; # for nuc in $seq
# if last nucleotide is masked, previous loop not includes its coord. 
$masked_flg &&( push @coords, $len);
\nwused{\\{NWmas1F-OLDI-1}}\nwendcode{}\nwbegindocs{30}\nwdocspar

\nwenddocs{}\nwbegincode{31}\sublabel{NWmas1F-Wria-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-Wria-1}}}\moddef{Writing masked regions coords in GFF~{\nwtagstyle{}\subpageref{NWmas1F-Wria-1}}}\endmoddef
$msk_num = scalar(@coords) / 2;
print STDERR "###         WRITING GFF COORDS: $msk_num masked regions found.\\n";
for (my $n = 0; $n <= $#coords; $n+=2) \{
    my $GFFstring = ("\\%s\\t" x 5).(".\\t" x 3).".\\n";
    printf STDOUT $GFFstring, $sid, "masked", "masked", @coords[$n..($n + 1)];
\}; # for coords in @coords
\nwused{\\{NWmas1F-OLDI-1}}\nwendcode{}\nwbegindocs{32}\nwdocspar

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{comment}
\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%% BACKMATTER

% \newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% \bibliographystyle{apalike}
% \bibliography{/home1/rguigo/docs/biblio/References}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\appendix

\sctn{empty appendix section}

\subsctn{empty appendix subsection}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{comment}
\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%
\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\sctn{Common code blocks}

\subsctn{PERL scripts}

\nwenddocs{}\nwbegincode{33}\sublabel{NWmas1F-PERC-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-PERC-1}}}\moddef{PERL shebang~{\nwtagstyle{}\subpageref{NWmas1F-PERC-1}}}\endmoddef
#!/usr/bin/perl -w
# This is perl, version 5.005_03 built for i386-linux
\LA{}GNU License~{\nwtagstyle{}\subpageref{NWmas1F-GNUB-1}}\RA{}
\LA{}Version Control Id Tag~{\nwtagstyle{}\subpageref{NWmas1F-VerM-1}}\RA{}
#
use strict;
\nwused{\\{NWmas1F-masH-1}}\nwendcode{}\nwbegindocs{34}\nwdocspar

\nwenddocs{}\nwbegincode{35}\sublabel{NWmas1F-GloQ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-GloQ-1}}}\moddef{Global Constants - Boolean~{\nwtagstyle{}\subpageref{NWmas1F-GloQ-1}}}\endmoddef
my ($T,$F) = (1,0); # for 'T'rue and 'F'alse
\eatline
\nwnotused{Global\ Constants\ -\ Boolean}\nwendcode{}\nwbegindocs{36}\nwdocspar
We also set here the date when the script is running and who is the user running it.

\nwenddocs{}\nwbegincode{37}\sublabel{NWmas1F-GloR-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-GloR-1}}}\moddef{Global Vars - User and Date~{\nwtagstyle{}\subpageref{NWmas1F-GloR-1}}}\endmoddef
my $DATE = localtime;
my $USER = $ENV\{USER\};
\eatline
\nwnotused{Global\ Vars\ -\ User\ and\ Date}\nwendcode{}\nwbegindocs{38}\nwdocspar

\subsubsctn{Timing our scripts}

The '{\tt{}Benchmark}' module encapsulates a number of routines to help to figure out how long it takes to execute a piece of code and the whole script.

\nwenddocs{}\nwbegincode{39}\sublabel{NWmas1F-UseN-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-UseN-1}}}\moddef{Use Modules - Benchmark~{\nwtagstyle{}\subpageref{NWmas1F-UseN-1}}}\endmoddef
use Benchmark;
  \LA{}Timer ON~{\nwtagstyle{}\subpageref{NWmas1F-Tim8-1}}\RA{}
\nwused{\\{NWmas1F-OLDI-1}}\nwendcode{}\nwbegindocs{40}\nwdocspar

See '{\tt{}man\ Benchmark}' for further info about this package. 
We set an array to keep record of timing for each section.

\nwenddocs{}\nwbegincode{41}\sublabel{NWmas1F-Tim8-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-Tim8-1}}}\moddef{Timer ON~{\nwtagstyle{}\subpageref{NWmas1F-Tim8-1}}}\endmoddef
my @Timer = (new Benchmark);
\nwused{\\{NWmas1F-UseN-1}}\nwendcode{}\nwbegindocs{42}\nwdocspar

\nwenddocs{}\nwbegincode{43}\sublabel{NWmas1F-ComS-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-ComS-1}}}\moddef{Common PERL subs - Benchmark~{\nwtagstyle{}\subpageref{NWmas1F-ComS-1}}}\endmoddef
sub timing() \{
    push @Timer, (new Benchmark);
    # partial time 
    $_[0] || 
        (return timestr(timediff($Timer[$#Timer],$Timer[($#Timer - 1)])));
    # total time
    return timestr(timediff($Timer[$#Timer],$Timer[0]));
\} # timing
\nwused{\\{NWmas1F-OLDI-1}}\nwendcode{}\nwbegindocs{44}\nwdocspar


\subsubsctn{Printing complex Data Structures}

With '{\tt{}Data::Dumper}' we are able to pretty print complex data structures for debugging them.


\nwenddocs{}\nwbegincode{45}\sublabel{NWmas1F-UseK-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-UseK-1}}}\moddef{Use Modules - Dumper~{\nwtagstyle{}\subpageref{NWmas1F-UseK-1}}}\endmoddef
use Data::Dumper;
local $Data::Dumper::Purity = 0;
local $Data::Dumper::Deepcopy = 1;
\nwnotused{Use\ Modules\ -\ Dumper}\nwendcode{}\nwbegindocs{46}\nwdocspar


\subsubsctn{Common functions}

\nwenddocs{}\nwbegincode{47}\sublabel{NWmas1F-SkiV-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-SkiV-1}}}\moddef{Skip comments and empty records~{\nwtagstyle{}\subpageref{NWmas1F-SkiV-1}}}\endmoddef
next if /^\\#/o;
next if /^\\s*$/o;
chomp;
\nwnotused{Skip\ comments\ and\ empty\ records}\nwendcode{}\nwbegindocs{48}\nwdocspar

\nwenddocs{}\nwbegincode{49}\sublabel{NWmas1F-ComQ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-ComQ-1}}}\moddef{Common PERL subs - Min Max~{\nwtagstyle{}\subpageref{NWmas1F-ComQ-1}}}\endmoddef
#
sub max() \{
    my $z = shift @_;
    foreach my $l (@_) \{ $z = $l if $l > $z \};
    return $z;
\} # max
sub min() \{
    my $z = shift @_;
    foreach my $l (@_) \{ $z = $l if $l < $z \};
    return $z;
\} # min
\nwnotused{Common\ PERL\ subs\ -\ Min\ Max}\nwendcode{}\nwbegindocs{50}\nwdocspar

\nwenddocs{}\nwbegincode{51}\sublabel{NWmas1F-ComS.2-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-ComS.2-1}}}\moddef{Common PERL subs - Text fill~{\nwtagstyle{}\subpageref{NWmas1F-ComS.2-1}}}\endmoddef
#
sub fill_right() \{ $_[0].($_[2] x ($_[1] - length($_[0]))) \}
sub fill_left()  \{ ($_[2] x ($_[1] - length($_[0]))).$_[0] \}
sub fill_mid()   \{ 
    my $l = length($_[0]);
    my $k = int(($_[1] - $l)/2);
    ($_[2] x $k).$_[0].($_[2] x ($_[1] - ($l+$k)));
\} # fill_mid
\nwnotused{Common\ PERL\ subs\ -\ Text\ fill}\nwendcode{}\nwbegindocs{52}\nwdocspar

These functions are used to report to STDERR a single char for each record processed (useful for reporting parsed records).

\nwenddocs{}\nwbegincode{53}\sublabel{NWmas1F-ComQ.2-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-ComQ.2-1}}}\moddef{Common PERL subs - Counter~{\nwtagstyle{}\subpageref{NWmas1F-ComQ.2-1}}}\endmoddef
#
sub counter \{ # $_[0]~current_pos++ $_[1]~char
    print STDERR "$_[1]";
    (($_[0] % 50) == 0) && (print STDERR "[".&fill_left($_[0],6,"0")."]\\n");
\} # counter
#
sub counter_end \{ # $_[0]~current_pos   $_[1]~char
    (($_[0] % 50) != 0) && (print STDERR "[".&fill_left($_[0],6,"0")."]\\n");
\} # counter_end
\nwnotused{Common\ PERL\ subs\ -\ Counter}\nwendcode{}\nwbegindocs{54}\nwdocspar

\nwenddocs{}\nwbegincode{55}\sublabel{NWmas1F-GloL-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-GloL-1}}}\moddef{Global Vars - Counter~{\nwtagstyle{}\subpageref{NWmas1F-GloL-1}}}\endmoddef
my ($n,$c); # counter and char (for &counter function)
\eatline
\nwnotused{Global\ Vars\ -\ Counter}\nwendcode{}\nwbegindocs{56}\nwdocspar

\subsubsctn{Common functions for reporting program processes}
\label{sec:messagerpt}

Function '{\tt{}report}' requires that a hash variable '{\tt{}{\char37}MessageList}' has been set, such hash contains the strings for each report message we will need. The first parameter for '{\tt{}report}' is a key for that hash, in order to retrieve the message string, the other parameters passed are processed by the {\tt{}sprintf} function on that string.

\nwenddocs{}\nwbegincode{57}\sublabel{NWmas1F-ComP-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-ComP-1}}}\moddef{Common PERL subs - STDERR~{\nwtagstyle{}\subpageref{NWmas1F-ComP-1}}}\endmoddef
sub report() \{ print STDERR sprintf($MessageList\{ shift @_ \},@_) \}
\nwalsodefined{\\{NWmas1F-ComP-2}}\nwnotused{Common\ PERL\ subs\ -\ STDERR}\nwendcode{}\nwbegindocs{58}\nwdocspar

The same happens to '{\tt{}warn}' function which also requires a hash variable '{\tt{}{\char37}ErrorList}' containing the error messages.

\nwenddocs{}\nwbegincode{59}\sublabel{NWmas1F-ComP-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-ComP-2}}}\moddef{Common PERL subs - STDERR~{\nwtagstyle{}\subpageref{NWmas1F-ComP-1}}}\plusendmoddef
sub warn() \{ print STDERR sprintf($ErrorList\{ shift @_ \}, @_) \}
\nwendcode{}\nwbegindocs{60}\nwdocspar

\subsctn{BASH scripts}

\nwenddocs{}\nwbegincode{61}\sublabel{NWmas1F-BASC-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-BASC-1}}}\moddef{BASH shebang~{\nwtagstyle{}\subpageref{NWmas1F-BASC-1}}}\endmoddef
#!/usr/bin/bash
# GNU bash, version 2.03.6(1)-release (i386-redhat-linux-gnu)
\LA{}Version Control Id Tag~{\nwtagstyle{}\subpageref{NWmas1F-VerM-1}}\RA{}
#
SECONDS=0 # Reset Timing
# Which script are we running...
L="####################"
\{ echo "$L$L$L$L";
  echo "### RUNNING [$0]";
  echo "### Current date:`date`";
  echo "###"; \} 1>&2;
\nwused{\\{NWmas1F-wea7-1}\\{NWmas1F-LaT8-1}}\nwendcode{}\nwbegindocs{62}\nwdocspar

\nwenddocs{}\nwbegincode{63}\sublabel{NWmas1F-BASF-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-BASF-1}}}\moddef{BASH script end~{\nwtagstyle{}\subpageref{NWmas1F-BASF-1}}}\endmoddef
\{ echo "###"; echo "### Execution time for [$0] : $SECONDS secs";
  echo "$L$L$L$L";
  echo ""; \} 1>&2;
#
exit 0
\nwused{\\{NWmas1F-wea7-1}\\{NWmas1F-LaT8-1}}\nwendcode{}\nwbegindocs{64}\nwdocspar

\subsctn{Version control tags}

This document is under Revision Control System (RCS). The version you are currently reading is the following:

\nwenddocs{}\nwbegincode{65}\sublabel{NWmas1F-VerM-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-VerM-1}}}\moddef{Version Control Id Tag~{\nwtagstyle{}\subpageref{NWmas1F-VerM-1}}}\endmoddef
# $Id: maskedfastacoords.tex,v 1.1 2001-09-06 18:27:09 jabril Exp $
\nwused{\\{NWmas1F-PERC-1}\\{NWmas1F-BASC-1}}\nwendcode{}\nwbegindocs{66}\nwdocspar

\subsctn{GNU General Public License}

\nwenddocs{}\nwbegincode{67}\sublabel{NWmas1F-GNUB-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-GNUB-1}}}\moddef{GNU License~{\nwtagstyle{}\subpageref{NWmas1F-GNUB-1}}}\endmoddef
# #----------------------------------------------------------------#
# #                          maskedfastacoords                         #
# #----------------------------------------------------------------#
# 
#    Remember to put a short description of your script here...
# 
#     Copyright (C) 2001 - Josep Francesc ABRIL FERRANDO  
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
# 
# #----------------------------------------------------------------#
\nwused{\\{NWmas1F-PERC-1}}\nwendcode{}\nwbegindocs{68}\nwdocspar

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\sctn{Extracting code blocks from this document}

From this file we can obtain both the code and the
documentation. The following instructions are needed:

\subsctn{Extracts Script code chunks from the {\noweb} file} % \\[-0.5ex]

Remember when tangling that '-L' option allows you to include program line-numbering relative to original {\noweb} file. Then the first line of the executable files is a comment, not a shebang, and must be removed to make scripts runnable.

\nwenddocs{}\nwbegincode{69}\sublabel{NWmas1F-tan8-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-tan8-1}}}\moddef{tangling~{\nwtagstyle{}\subpageref{NWmas1F-tan8-1}}}\endmoddef
# showing line numbering comments in program
notangle -L -R"maskedfastacoords" $WORK/$nwfile.nw | \\
    perl -ne '$.>1 && print' | cpif $BIN/maskedfastacoords.pl ;
chmod a+x $BIN/maskedfastacoords.pl ;
\nwalsodefined{\\{NWmas1F-tan8-2}\\{NWmas1F-tan8-3}\\{NWmas1F-tan8-4}\\{NWmas1F-tan8-5}}\nwnotused{tangling}\nwendcode{}\nwbegindocs{70}\nwdocspar

\nwenddocs{}\nwbegincode{71}\sublabel{NWmas1F-tan8-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-tan8-2}}}\moddef{tangling~{\nwtagstyle{}\subpageref{NWmas1F-tan8-1}}}\plusendmoddef
# reformating program with perltidy
notangle -R"maskedfastacoords" $WORK/$nwfile.nw | \\
    perltidy - | cpif $BIN/maskedfastacoords.pl ;
# html pretty-printing program with perltidy
notangle -R"maskedfastacoords" $WORK/$nwfile.nw | \\
    perltidy -html - | cpif $DOCS/html/maskedfastacoords.html ;
#
\nwendcode{}\nwbegindocs{72}\nwdocspar

\subsctn{Extracting different Config Files} % \\[-0.5ex]

\nwenddocs{}\nwbegincode{73}\sublabel{NWmas1F-tan8-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-tan8-3}}}\moddef{tangling~{\nwtagstyle{}\subpageref{NWmas1F-tan8-1}}}\plusendmoddef
notangle -R"root" $WORK/$nwfile.nw | \\
         cpif $DATA/root_config ;
\nwendcode{}\nwbegindocs{74}%$

\subsctn{Extracting documentation and \LaTeX{}'ing it} % \\[-0.5ex] %'

\nwenddocs{}\nwbegincode{75}\sublabel{NWmas1F-tan8-4}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-tan8-4}}}\moddef{tangling~{\nwtagstyle{}\subpageref{NWmas1F-tan8-1}}}\plusendmoddef
notangle -Rweaving  $WORK/$nwfile.nw | cpif $WORK/nw2tex ;
notangle -RLaTeXing $WORK/$nwfile.nw | cpif $WORK/ltx ;
chmod a+x $WORK/nw2tex $WORK/ltx;
\nwendcode{}\nwbegindocs{76}\nwdocspar

\nwenddocs{}\nwbegincode{77}\sublabel{NWmas1F-tanY-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-tanY-1}}}\moddef{tangling complementary LaTeX files~{\nwtagstyle{}\subpageref{NWmas1F-tanY-1}}}\endmoddef
notangle -R"HIDE: LaTeX new definitions" $WORK/$nwfile.nw | cpif $DOCS/defs.tex ;
notangle -R"HIDE: TODO" $WORK/$nwfile.nw | cpif $DOCS/todo.tex ; 
\nwused{\\{NWmas1F-wea7-1}}\nwendcode{}\nwbegindocs{78}\nwdocspar

\nwenddocs{}\nwbegincode{79}\sublabel{NWmas1F-wea7-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-wea7-1}}}\moddef{weaving~{\nwtagstyle{}\subpageref{NWmas1F-wea7-1}}}\endmoddef
\LA{}BASH shebang~{\nwtagstyle{}\subpageref{NWmas1F-BASC-1}}\RA{}
# weaving and LaTeXing
\LA{}BASH Environment Variables~{\nwtagstyle{}\subpageref{NWmas1F-BASQ-1}}\RA{}
\LA{}tangling complementary LaTeX files~{\nwtagstyle{}\subpageref{NWmas1F-tanY-1}}\RA{}
noweave -v -t4 -delay -x -filter 'elide "HIDE: *"' \\
        $WORK/$nwfile.nw | cpif $DOCS/$nwfile.tex ;
# noweave -t4 -delay -index $WORK/$nwfile.nw > $DOCS/$nwfile.tex 
pushd $DOCS/ ;
#
latex $nwfile.tex ;
dvips $nwfile.dvi -o $nwfile.ps -t a4 ;
#
popd;
\LA{}BASH script end~{\nwtagstyle{}\subpageref{NWmas1F-BASF-1}}\RA{}
\nwnotused{weaving}\nwendcode{}\nwbegindocs{80}\nwdocspar

\nwenddocs{}\nwbegincode{81}\sublabel{NWmas1F-LaT8-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-LaT8-1}}}\moddef{LaTeXing~{\nwtagstyle{}\subpageref{NWmas1F-LaT8-1}}}\endmoddef
\LA{}BASH shebang~{\nwtagstyle{}\subpageref{NWmas1F-BASC-1}}\RA{}
# only LaTeXing
\LA{}BASH Environment Variables~{\nwtagstyle{}\subpageref{NWmas1F-BASQ-1}}\RA{}
pushd $DOCS/ ;
#
echo "### RUNNING LaTeX on $nwfile.tex" 1>&2 ;
latex $nwfile.tex ; 
latex $nwfile.tex ; 
latex $nwfile.tex ;
dvips $nwfile.dvi -o $nwfile.ps -t a4 ;
#
# pdflatex $nwfile.tex ;
echo "### CONVERTING PS to PDF: $nwfile" 1>&2 ;
ps2pdf $nwfile.ps $nwfile.pdf ;
#
popd ;
\LA{}BASH script end~{\nwtagstyle{}\subpageref{NWmas1F-BASF-1}}\RA{}
\nwnotused{LaTeXing}\nwendcode{}\nwbegindocs{82}%$

\subsctn{Defining working shell variables for the current project} % \\[-0.5ex]

\nwenddocs{}\nwbegincode{83}\sublabel{NWmas1F-BASQ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-BASQ-1}}}\moddef{BASH Environment Variables~{\nwtagstyle{}\subpageref{NWmas1F-BASQ-1}}}\endmoddef
#
# Setting Global Variables
WORK="/home/ug/jabril/development/softjabril/maskedfastacoords" ;
BIN="$WORK/bin" ;
PARAM="$BIN/param" ;
DOCS="$WORK/docs" ;
DATA="$WORK/data" ;
nwfile="maskedfastacoords" ;
export WORK BIN PARAM DOCS DATA nwfile ;
#
\nwused{\\{NWmas1F-wea7-1}\\{NWmas1F-LaT8-1}}\nwendcode{}\nwbegindocs{84}\nwdocspar

\nwenddocs{}\nwbegincode{85}\sublabel{NWmas1F-tan8-5}\nwmargintag{{\nwtagstyle{}\subpageref{NWmas1F-tan8-5}}}\moddef{tangling~{\nwtagstyle{}\subpageref{NWmas1F-tan8-1}}}\plusendmoddef
# 
# BASH Environment Variables
notangle -R'BASH Environment Variables' $WORK/$nwfile.nw | \\
         cpif $WORK/.bash_VARS ; 
source $WORK/.bash_VARS ;
#
\nwendcode{}

\nwixlogsorted{c}{{BASH Environment Variables}{NWmas1F-BASQ-1}{\nwixu{NWmas1F-wea7-1}\nwixu{NWmas1F-LaT8-1}\nwixd{NWmas1F-BASQ-1}}}%
\nwixlogsorted{c}{{BASH script end}{NWmas1F-BASF-1}{\nwixd{NWmas1F-BASF-1}\nwixu{NWmas1F-wea7-1}\nwixu{NWmas1F-LaT8-1}}}%
\nwixlogsorted{c}{{BASH shebang}{NWmas1F-BASC-1}{\nwixd{NWmas1F-BASC-1}\nwixu{NWmas1F-wea7-1}\nwixu{NWmas1F-LaT8-1}}}%
\nwixlogsorted{c}{{Common PERL subs - Benchmark}{NWmas1F-ComS-1}{\nwixu{NWmas1F-OLDI-1}\nwixd{NWmas1F-ComS-1}}}%
\nwixlogsorted{c}{{Common PERL subs - Counter}{NWmas1F-ComQ.2-1}{\nwixd{NWmas1F-ComQ.2-1}}}%
\nwixlogsorted{c}{{Common PERL subs - Min Max}{NWmas1F-ComQ-1}{\nwixd{NWmas1F-ComQ-1}}}%
\nwixlogsorted{c}{{Common PERL subs - STDERR}{NWmas1F-ComP-1}{\nwixd{NWmas1F-ComP-1}\nwixd{NWmas1F-ComP-2}}}%
\nwixlogsorted{c}{{Common PERL subs - Text fill}{NWmas1F-ComS.2-1}{\nwixd{NWmas1F-ComS.2-1}}}%
\nwixlogsorted{c}{{Finding masked regions coords}{NWmas1F-FinT-1}{\nwixu{NWmas1F-OLDI-1}\nwixd{NWmas1F-FinT-1}}}%
\nwixlogsorted{c}{{Functions}{NWmas1F-Fun9-1}{\nwixu{NWmas1F-masH-1}\nwixd{NWmas1F-Fun9-1}}}%
\nwixlogsorted{c}{{GNU License}{NWmas1F-GNUB-1}{\nwixu{NWmas1F-PERC-1}\nwixd{NWmas1F-GNUB-1}}}%
\nwixlogsorted{c}{{Global Constants - Boolean}{NWmas1F-GloQ-1}{\nwixd{NWmas1F-GloQ-1}}}%
\nwixlogsorted{c}{{Global Vars}{NWmas1F-GloB-1}{\nwixu{NWmas1F-masH-1}\nwixd{NWmas1F-GloB-1}}}%
\nwixlogsorted{c}{{Global Vars - Counter}{NWmas1F-GloL-1}{\nwixd{NWmas1F-GloL-1}}}%
\nwixlogsorted{c}{{Global Vars - User and Date}{NWmas1F-GloR-1}{\nwixd{NWmas1F-GloR-1}}}%
\nwixlogsorted{c}{{HIDE: LaTeX new definitions}{NWmas1F-HIDR-1}{\nwixd{NWmas1F-HIDR-1}}}%
\nwixlogsorted{c}{{HIDE: TODO}{NWmas1F-HIDA-1}{\nwixd{NWmas1F-HIDA-1}}}%
\nwixlogsorted{c}{{HIDE: new LaTeX commands}{NWmas1F-HIDO-1}{\nwixu{NWmas1F-HIDR-1}\nwixd{NWmas1F-HIDO-1}}}%
\nwixlogsorted{c}{{HIDE: new LaTeX definitions}{NWmas1F-HIDR.2-1}{\nwixu{NWmas1F-HIDR-1}\nwixd{NWmas1F-HIDR.2-1}}}%
\nwixlogsorted{c}{{HIDE: new LaTeX pstricks}{NWmas1F-HIDO.2-1}{\nwixu{NWmas1F-HIDR-1}\nwixd{NWmas1F-HIDO.2-1}}}%
\nwixlogsorted{c}{{HIDE: new LaTeX urls}{NWmas1F-HIDK-1}{\nwixu{NWmas1F-HIDR-1}\nwixd{NWmas1F-HIDK-1}}}%
\nwixlogsorted{c}{{HIDE: new defs TODO}{NWmas1F-HIDJ-1}{\nwixu{NWmas1F-HIDR-1}\nwixd{NWmas1F-HIDJ-1}}}%
\nwixlogsorted{c}{{LaTeXing}{NWmas1F-LaT8-1}{\nwixd{NWmas1F-LaT8-1}}}%
\nwixlogsorted{c}{{Main Loop}{NWmas1F-Mai9-1}{\nwixu{NWmas1F-masH-1}\nwixd{NWmas1F-Mai9-1}}}%
\nwixlogsorted{c}{{OLD IMPLEMENTATION}{NWmas1F-OLDI-1}{\nwixd{NWmas1F-OLDI-1}}}%
\nwixlogsorted{c}{{PERL shebang}{NWmas1F-PERC-1}{\nwixu{NWmas1F-masH-1}\nwixd{NWmas1F-PERC-1}}}%
\nwixlogsorted{c}{{Setting sequence variables from fasta record}{NWmas1F-Seti-1}{\nwixu{NWmas1F-OLDI-1}\nwixd{NWmas1F-Seti-1}}}%
\nwixlogsorted{c}{{Skip comments and empty records}{NWmas1F-SkiV-1}{\nwixd{NWmas1F-SkiV-1}}}%
\nwixlogsorted{c}{{Timer ON}{NWmas1F-Tim8-1}{\nwixu{NWmas1F-UseN-1}\nwixd{NWmas1F-Tim8-1}}}%
\nwixlogsorted{c}{{Use Modules}{NWmas1F-UseB-1}{\nwixu{NWmas1F-masH-1}\nwixd{NWmas1F-UseB-1}}}%
\nwixlogsorted{c}{{Use Modules - Benchmark}{NWmas1F-UseN-1}{\nwixu{NWmas1F-OLDI-1}\nwixd{NWmas1F-UseN-1}}}%
\nwixlogsorted{c}{{Use Modules - Dumper}{NWmas1F-UseK-1}{\nwixd{NWmas1F-UseK-1}}}%
\nwixlogsorted{c}{{Version Control Id Tag}{NWmas1F-VerM-1}{\nwixu{NWmas1F-PERC-1}\nwixu{NWmas1F-BASC-1}\nwixd{NWmas1F-VerM-1}}}%
\nwixlogsorted{c}{{Writing masked regions coords in GFF}{NWmas1F-Wria-1}{\nwixu{NWmas1F-OLDI-1}\nwixd{NWmas1F-Wria-1}}}%
\nwixlogsorted{c}{{maskedfastacoords}{NWmas1F-masH-1}{\nwixd{NWmas1F-masH-1}}}%
\nwixlogsorted{c}{{tangling}{NWmas1F-tan8-1}{\nwixd{NWmas1F-tan8-1}\nwixd{NWmas1F-tan8-2}\nwixd{NWmas1F-tan8-3}\nwixd{NWmas1F-tan8-4}\nwixd{NWmas1F-tan8-5}}}%
\nwixlogsorted{c}{{tangling complementary LaTeX files}{NWmas1F-tanY-1}{\nwixd{NWmas1F-tanY-1}\nwixu{NWmas1F-wea7-1}}}%
\nwixlogsorted{c}{{weaving}{NWmas1F-wea7-1}{\nwixd{NWmas1F-wea7-1}}}%
\nwbegindocs{86}\nwdocspar

%
\end{document}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\nwenddocs{}
