##################################################
#
# README_plotlayers
#
# This README runs as a shell script.
# Here you can find the commands
# we used to produce all the figures for:
#
#   "Plot layers for GFF2APLOT HOWTO"
#      Checking to which layer each plot element is drawn.
#
# $Id: README_plotlayers,v 1.4 2002-12-24 13:44:32 jabril Exp $
#
##################################################
#
SECONDS=0 ;
#
#
echo "# Getting the PostScripts with GFF2APLOT" ;
#
echo "#  -> Empty Plot" ;
#
$BIN/gff2aplot.pl                      \
    --logs-filename plot_layers_bg.log \
    --show-percent-box                 \
    --show-extra-box                   \
    --x-sequence-coords 0..1000        \
    --y-sequence-coords 0..1000        \
    --title 'Empty Plot'               \
    --percent-box-label 'SCORES'       \
    --extra-box-label 'EXTRA-BOX'      \
    --x-label ''  --y-label ''         \
    -- plot_layers_nodata.gff          \
     > plot_layers_bg.ps               \
    2> plot_layers_bg.err              ;
#
$BIN/gff2aplot.pl                         \
    --logs-filename plot_layers_bgcol.log \
    --show-percent-box                    \
    --show-extra-box                      \
    --x-sequence-coords 0..1000           \
    --y-sequence-coords 0..1000           \
    --title 'Empty Plot'                  \
    --subtitle 'Setting background color to "lightblue".' \
    --percent-box-label 'SCORES'          \
    --extra-box-label 'EXTRA-BOX'         \
    --x-label ''  --y-label ''            \
    --background-color lightblue          \
    -- plot_layers_nodata.gff             \
     > plot_layers_bgcol.ps               \
    2> plot_layers_bgcol.err              ;
#
$BIN/gff2aplot.pl                          \
    --logs-filename plot_layers_boxcol.log \
    --show-percent-box                     \
    --show-extra-box                       \
    --x-sequence-coords 0..1000            \
    --y-sequence-coords 0..1000            \
    --title 'Empty Plot'                   \
    --subtitle 'Filling main plot boxes with "verylightblue" color.' \
    --percent-box-label 'SCORES'           \
    --extra-box-label 'EXTRA-BOX'          \
    --x-label ''  --y-label ''             \
    --background-color  lightblue          \
    --aplot-box-color   verylightblue      \
    --percent-box-color verylightblue      \
    --extra-box-color   verylightblue      \
    -- plot_layers_nodata.gff              \
     > plot_layers_boxcol.ps               \
    2> plot_layers_boxcol.err              ;
#
$BIN/gff2aplot.pl                          \
    --logs-filename plot_layers_grd.log    \
    --show-percent-box                     \
    --show-extra-box                       \
    --x-sequence-coords 0..1000            \
    --y-sequence-coords 0..1000            \
    --title 'Empty Plot'                   \
    --subtitle 'Switching GRID on (all three plot boxes).' \
    --percent-box-label 'SCORES'           \
    --extra-box-label 'EXTRA-BOX'          \
    --x-label ''  --y-label ''             \
    --background-color  lightblue          \
    --aplot-box-color   verylightblue      \
    --percent-box-color verylightblue      \
    --extra-box-color   verylightblue      \
    --show-grid                            \
    -- plot_layers_nodata.gff              \
     > plot_layers_grd.ps                  \
    2> plot_layers_grd.err                 ;
#
#
echo "#  -> Global feature layers" ;
#
cat <<'EOF' > plot_layers_feat.rc ;
#
# plot_layers_feat.rc
#
# $Id: README_plotlayers,v 1.4 2002-12-24 13:44:32 jabril Exp $
#
# L #
show_percent_box=on
show_extra_box=on
x_sequence_coords=0..1000
y_sequence_coords=0..1000
percent_box_label=SCORES
extra_box_label=EXTRA-BOX
background_color=lightblue
aplot_box_bgcolor=verylightblue
percent_box_bgcolor=verylightblue
extra_box_bgcolor=verylightblue
show_grid=on

#
# F #
terminal::feature_shape=half_arrow
internal::feature_shape=box
first::feature_shape=half_arrow_end
EOF
#
$BIN/gff2aplot.pl                          \
    --logs-filename plot_layers_feat.log   \
    --custom-filename plot_layers_feat.rc  \
    --title 'Annotated Axes'               \
    --subtitle 'Showing GFF annotation on both, X and Y, axes.' \
    --x-label 'X Sequence'                 \
    --y-label 'Y Sequence'                 \
    -- plot_layers_noaln.gff               \
     > plot_layers_feat.ps                 \
    2> plot_layers_feat.err                ;
#
$BIN/gff2aplot.pl                            \
    --logs-filename plot_layers_featrib.log  \
    --custom-filename plot_layers_feat.rc    \
    --title 'Annotated Axes'                 \
    --subtitle 'Showing ribbons for all GFF-features.' \
    --x-label 'X Sequence'                   \
    --y-label 'Y Sequence'                   \
    --show-ribbons ribbons                   \
    --layout-var 'ribbon_color=verylightred' \
    -- plot_layers_noaln.gff                 \
     > plot_layers_featrib.ps                \
    2> plot_layers_featrib.err               ;
#
$BIN/gff2aplot.pl                             \
    --logs-filename plot_layers_featribln.log \
    --custom-filename plot_layers_feat.rc     \
    --title 'Annotated Axes'                  \
    --subtitle 'Showing ribbons for all GFF-features.' \
    --x-label 'X Sequence'                    \
    --y-label 'Y Sequence'                    \
    --show-ribbons both                       \
    --layout-var 'ribbon_color=verylightred'  \
    -- plot_layers_noaln.gff                  \
     > plot_layers_featribln.ps               \
    2> plot_layers_featribln.err              ;
#
#
echo "#  -> Extra custom features layers (PRE)" ;
#
cat <<'EOF' > plot_layers_feat2.rc ;
#
# plot_layers_feat2.rc
#
# $Id: README_plotlayers,v 1.4 2002-12-24 13:44:32 jabril Exp $
#

# L #

x_label=X Sequence
y_label=Y Sequence
show_ribbons=on
ribbon_style=both
ribbon_color=verylightred

EOF
#
$BIN/gff2aplot.pl                          \
    --logs-filename plot_layers_prezm.log  \
    --custom-filename plot_layers_feat.rc  \
    --custom-filename plot_layers_feat2.rc \
    --title 'Layers for Extra Custom-Features' \
    --subtitle 'Showing zoom area mark.'   \
    --x-sequence-zoom  100..400            \
    --y-sequence-zoom  600..900            \
    --zoom-area                            \
    -- plot_layers_noaln.gff               \
     > plot_layers_prezm.ps                \
    2> plot_layers_prezm.err               ;
#
#
cat <<'EOF' > plot_layers_pre.rc ;
#
# plot_layers_pre.rc
#
# $Id: README_plotlayers,v 1.4 2002-12-24 13:44:32 jabril Exp $
#
# X #

# box  <Xori> <Xend> <Yori> <Yend>
#       [ L:<line_color> ] [ S:<line_style> ] [ W:<line_width> ] [ F:<fill_color> ]
box 150 350 150 350 L:darkviolet S:dotted W:2pt F:lightviolet

# circle  <Cx> <Cy> <Rx> <Ry>
#       [ A:<angle> ] [ L:<line_color> ] [ S:<line_style> ] [ W:<line_width> ] [ F:<fill_color> ]
circle 400 600 75 75 S:solid W:2pt L:lightbrown F:darkyellow
circle 700 200 100 50 A:45 S:dashed W:1 L:lightbrown F:darkorange

EOF
#
$BIN/gff2aplot.pl                          \
    --logs-filename plot_layers_pre.log    \
    --custom-filename plot_layers_feat.rc  \
    --custom-filename plot_layers_feat2.rc \
    --title 'Layers for Extra Custom-Features (PRE)' \
    --subtitle 'Showing "extra" annotations that appear below any alignment.' \
    --x-sequence-zoom  100..400            \
    --y-sequence-zoom  600..900            \
    --custom-filename plot_layers_pre.rc   \
    --zoom-area                            \
    -- plot_layers_noaln.gff               \
     > plot_layers_pre.ps                  \
    2> plot_layers_pre.err                 ;
#
#
echo "#  -> Alignment" ;
#
$BIN/gff2aplot.pl                          \
    --logs-filename plot_layers_aln.log    \
    --custom-filename plot_layers_feat.rc  \
    --custom-filename plot_layers_feat2.rc \
    --title 'Alignment Features Layer'     \
    --subtitle 'We are changing alignment features color too.' \
    --x-sequence-zoom  100..400            \
    --y-sequence-zoom  600..900            \
    --custom-filename plot_layers_pre.rc   \
    --zoom-area                            \
    --feature-var '*::alignment_color=darkblue' \
    -- plot_layers.gff                     \
     > plot_layers_aln.ps                  \
    2> plot_layers_aln.err                 ;
#
#
# echo "#  -> SWAPPING Alignment Layers" ;
#
# > plot_layers_swpaln.ps
#
#
echo "#  -> Extra custom features layers (POST)" ;
#
cat <<'EOF' > plot_layers_post.rc ;
#
# plot_layers_post.rc
#
# $Id: README_plotlayers,v 1.4 2002-12-24 13:44:32 jabril Exp $
#
# X #

# arrow  <Cx> <Cy> <length>
#       [ A:<angle> ] [ L:<line_color> ] [ S:<line_style> ] [ W:<line_width> ] 
#       [ N:<font_name> ] [ Z:<font_size> ]
#       [ H:<horizontal_align> ] [ V:<vertical_align> ] [ T:<text_color> ] [ "<string>" ]
arrow 400 350 1cm A:0   N:helvetica Z:10pt T:red "0deg"   W:1.5pt
arrow 400 350 2cm A:-75 N:helvetica Z:10pt T:red "-75deg" W:1.5pt
arrow 400 350 2cm A:85  N:helvetica Z:10pt T:red "85deg"  W:1.5pt
arrow 400 350 2cm A:165 N:helvetica Z:10pt T:red "165deg" W:1.5pt
arrow 400 350 3cm A:235 N:helvetica Z:10pt T:red "235deg" W:1.5pt

# text  <Cx> <Cy> "<string>"
#       [ A:<angle> ] [ N:<font_name> ] [ Z:<font_size> ]
#       [ H:<horizontal_align> ] [ V:<vertical_align> ] [ T:<text_color> ]
text 750 750 H:center V:center Z:12pt N:helvetica-bold "A free-text string example!!!"

###########################################
EOF
#
$BIN/gff2aplot.pl                          \
    --logs-filename plot_layers_post.log   \
    --custom-filename plot_layers_feat.rc  \
    --custom-filename plot_layers_feat2.rc \
    --title 'Layers for Extra Custom-Features (POST)' \
    --subtitle 'Showing "extra" annotations that appear above any alignment.' \
    --x-sequence-zoom  100..400            \
    --y-sequence-zoom  600..900            \
    --custom-filename plot_layers_pre.rc   \
    --custom-filename plot_layers_post.rc  \
    --zoom-area                            \
    --feature-var '*::alignment_color=darkblue' \
    -- plot_layers.gff                     \
     > plot_layers_post.ps                 \
    2> plot_layers_post.err                ;
#
#
# Preparing web images
#
filenames () {
  cat << 'EOF';
plot_layers_bg
plot_layers_bgcol
plot_layers_boxcol
plot_layers_grd
plot_layers_feat
plot_layers_featrib
plot_layers_featribln
plot_layers_prezm
plot_layers_pre
plot_layers_aln
plot_layers_post
EOF
};
#
# echo "# Using \"ghostscript\" to obtain JPEG images from PS files" ;
echo "# Using \"ghostscript\" to obtain PNG images from PS files" ;
#
filenames | while read n ;
  do { 
    echo "# -> $n" ;
    ghostscript -dBATCH -dNOPAUSE -r300 \
         -sPAPERSIZE=a4 -sDEVICE=png16m \
         -sOutputFile=$n.png $n.ps      ;
    cp -v $n.png $n.s.png ;
    # mogrify is a ImageMagick tool that allow us to transform images on batch,
    # large high-resolution jpeg files are scaled down to thumbnail resolution (2479x3508=>123x175)
    # it overwrites original file (so that we previously get a renamed copy for each jpeg to process). 
    mogrify -verbose -geometry 5% $n.s.png ;
    #
    # ghostscript -dBATCH -dNOPAUSE -r300 \
    #      -sPAPERSIZE=a4 -sDEVICE=jpeg   \
    #      -sOutputFile=$n.jpg $n.ps      ;
    # png large version is pretty smaller than jpeg
    # cp -v $n.jpg $n.s.jpg ;
    # mogrify -verbose -geometry 5% $n.s.jpg ;
    };
  done ;
convert 'vid:*.s.png'  plot_layers.summary.png 
#
echo "# Using \"ghostscript\" to obtain PDF documents from PS files" ;
#
filenames | while read n ;
  do { 
    echo "# -> $n" ;
    ghostscript -dBATCH -dNOPAUSE -r300   \
         -sPAPERSIZE=a4 -sDEVICE=pdfwrite \
         -sOutputFile=$n.pdf $n.ps        ;
    };
  done ;
#
#
echo "# LaTeXing all figures together..." ;
#
latex plotlayers.tex;
dvips plotlayers.dvi -o plotlayers.ps;
#
#
echo "###" ;
echo "### TOTAL TIME: $SECONDS seconds..." ; 
#
#
# That's all folks... ;^D
#
#        >> Copyleft (C) 2002 - Josep F. Abril <<
#
