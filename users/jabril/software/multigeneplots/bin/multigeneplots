#!/usr/bin/perl -w
# This is perl, version 5.005_03 built for i386-linux
#
#line 275 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
# #----------------------------------------------------------------#
# #                          multigeneplots                         #
# #----------------------------------------------------------------#
# 
#  $PROGRAM [options] < input_files > output_files
#
#  Making GFF2PS plots for each GFF group related to a given source.
#
#
#     Copyright (C) 2001 - Josep Francesc ABRIL FERRANDO  
#line 686 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
#line 879 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
# 
# #----------------------------------------------------------------#
#line 688 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
#line 873 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
# $Id: multigeneplots,v 1.1 2001-10-15 15:01:11 jabril Exp $
#line 690 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
use strict;
#
#line 264 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my $PROGRAM = 'multigeneplots';
my $VERSION = '0.1_alpha';
#line 694 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my $DATE = localtime;
my $USER = defined($ENV{USER}) ? $ENV{USER} : 'Child Process';
my $host = `hostname`;
chomp($host);
#
#line 291 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
# MODULES
#
#line 711 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
use Benchmark;
  
#line 719 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my @Timer = (new Benchmark);
#line 354 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
use Getopt::Long;
Getopt::Long::Configure qw/ bundling /;
#line 295 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
# VARIABLES
#
#line 702 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my (*T,*F) = (\1,\0); # for 'T'rue and 'F'alse
#line 798 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my ($n,$c); # counter and char (for &counter function)
#line 820 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my $line = ('#' x 80)."\n";
my $s = '### ';
my $sp = "###\n";
my $Error = "\<\<\<  ERROR  \>\>\> ";
my $Warn  = "\<\<\< WARNING \>\>\> ";
my $spl   = "\<\<\<\-\-\-\-\-\-\-\-\-\>\>\>\n";
my $spw   = "\<\<\<         \>\>\> ";
#line 832 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my %Messages = (
    # ERROR MESSAGES
    
#line 385 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
'UNKNOWN_CL_OPTION' =>
  $Warn."Error trapped while processing command-line:\n".(" "x16)."\%s\n",
'CMD_LINE_ERROR' =>
  $spl.$spw." Please, check your command-line options!!!\n".$Error."\n".
  $spw." ".("."x12)." Type \"$PROGRAM -h\" for help.\n".$spl,
#line 835 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
    
#line 445 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
FILE_NO_OPEN =>
  $spl.$Warn."Cannot Open Current file \"\%s\" . Not used !!!\n".$spl,
#line 836 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
    # WORKING MESSAGES
    
#line 331 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
'PROG-START'  => "$line$s\n$s Running $PROGRAM\n$s\n".
                 "$s HOST: $host\n".
                 "$s USER: $USER\n".
                 "$s DATE: $DATE\n$s\n$line$s\n" ,
'PROG-FINISH' => "$s\n$line$s\n$s $PROGRAM FINISHED\n$s\n".
                 "$s TOTAL TIME: \%s\n$line" ,
#line 646 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
SETTING_VARS => $sp."### Variable Definition Finished...\n".$sp,
#line 838 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
    
#line 492 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
'SHOW_VERSION' => $sp."### \%s -- Version: \%s\n".$sp,
#line 839 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
    
#line 450 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
CHECKING_FILENAMES =>
  $sp."### Validating INPUT FILENAMES\n".$sp,
READING_FILE =>
  "###---> \"\%s\" exists, including as Input File.\n",
READING_STDIN =>
  "###---> Including GFF records from standard input.\n",  
#line 840 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
   ); # %Messages 
#line 318 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my %CmdLineVar = (
                 
#line 569 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
GFFCOORDS  => 1,
SHOWGROUPS => 0,
#line 320 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
                 
                 );
#line 441 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my @data_files = ();
#line 299 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
# MAIN LOOP
#
#line 325 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
&main();

exit(0);
#line 303 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
# FUNCTIONS
#
#line 365 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub parse_cmdline() {
    
#line 395 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my $cmdln_stdin = undef;
for (my $a = 0; $a <= $#ARGV; $a++) { 
    next unless $ARGV[$a] =~ /^-$/o;
    $cmdln_stdin = $a - $#ARGV;
    splice(@ARGV,$a,1);
};    

#line 368 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
    $SIG{__WARN__} = sub { &warn('UNKNOWN_CL_OPTION',$T,$_[0]) };
    GetOptions(
               
#line 565 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
"g|genomic-coords" => sub { $CmdLineVar{GFFCOORDS} = 1 },
"i|include-groups" => \$CmdLineVar{SHOWGROUPS},
#line 371 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
               
               
#line 476 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
"version"   => \&prt_version, 
"h|help|?"  => \&prt_help,
#line 373 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
               ) || (&warn('CMD_LINE_ERROR',$T), exit(1));
    $SIG{__WARN__} = 'DEFAULT';

    &report("PROG-START");
    @data_files = ();
    &set_input_file($cmdln_stdin);
    @ARGV = (); # ensuring that command-line ARGVs array is empty
    
} # parse_cmdline
#line 415 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub set_input_file() {
    my $stdin_flg = $F;
    
#line 461 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
my $chk_stdin = shift @_;
my $t = scalar(@ARGV);
defined($chk_stdin) && do {
    abs($chk_stdin) > $t && ($chk_stdin = -$t);
	$chk_stdin > 0  && ($chk_stdin = 0 );
    $t += $chk_stdin;
    splice(@ARGV,$t,0,'-');
};
#line 418 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
    &report("CHECKING_FILENAMES");
  FILECHK: foreach my $test_file (@ARGV) {
        $test_file ne '-' && do {
            -e $test_file || do {
                &warn('FILE_NO_OPEN',$T,$test_file);
                next FILECHK;
            };
            &report('READING_FILE',$test_file);
            push @data_files, $test_file;
            next FILECHK;
        };
        $stdin_flg = $T;
        push @data_files, '-';
	}; # foreach
    scalar(@data_files) == 0 && do {
        push @data_files, '-';
        $stdin_flg = $T;
    };
    $stdin_flg && &report('READING_STDIN');
} # set_input_file
#line 485 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub prt_version() {
    &report('SHOW_VERSION',$PROGRAM,$VERSION);
    exit(1);
} # prt_version
#line 498 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub prt_help() {
    print STDERR <<"+++EndOfHelp+++";
PROGRAM:
                        $PROGRAM - $VERSION

    
#line 271 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
Making GFF2PS plots for each GFF group related to a given source.

#line 505 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
USAGE:    
#line 268 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
$PROGRAM [options] < input_files > output_files


#line 508 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
DESCRIPTION:

    
#line 271 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
Making GFF2PS plots for each GFF group related to a given source.


#line 513 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
REQUIRES:

    
#line 533 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
$PROGRAM needs the following Perl modules 
installed in your system, we used those available 
from the standard Perl distribution. Those that 
are not in the standard distribution are marked 
with an '(*)', in such cases make sure that you 
already have downloaded them from CPAN 
(http://www.perl.com/CPAN) and installed.

  
#line 359 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
"Getopt::Long" - processing command-line options.
#line 542 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
  
#line 734 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
"Benchmark" - checking and comparing running times of code.


#line 518 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
COMMAND-LINE OPTIONS:

    
#line 546 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
A double dash on itself "--" signals end of the options
and start of file names (if present). After double dash,
you can use a single dash "-" as STDIN placeholder. 
Available options and a short description are listed here:

+ General options:

  
#line 480 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
-h, --help            Shows this help.
--version             Shows current version and exits.

#line 555 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
  
#line 573 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
-g, --genomic-coords   Output GFF coords fields (columns 4th and 5th)
                       are set as genomic coords (by default).

#line 557 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
+ GFF output:

  


#line 523 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
BUGS:    Report any problem to 'jabril\@imim.es'.

AUTHOR:  $PROGRAM is under GNU-GPL (C) 2000 - Josep F. Abril

+++EndOfHelp+++
    exit(1);
} # prt_help
#line 618 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub main() {
    &parse_cmdline(); # PROG-START
    &set_output_subs();
    foreach my $lfile (@data_files) {
        &parse_input_files($lfile);
    }; # foreach $lfile
    &sort_by_acceptor();
    &output_extended_GFF();
    &report('PROG-FINISH',&timing($T));
} # main
#line 638 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub set_output_subs() {
    &report("SETTING_VARS");
} # set_output_subs
#line 773 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
sub fill_right() { $_[0].($_[2] x ($_[1] - length($_[0]))) }
sub fill_left()  { ($_[2] x ($_[1] - length($_[0]))).$_[0] }
sub fill_mid()   { 
    my $l = length($_[0]);
    my $k = int(($_[1] - $l)/2);
    ($_[2] x $k).$_[0].($_[2] x ($_[1] - ($l+$k)));
} # fill_mid
#line 786 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
sub counter { # $_[0]~current_pos++ $_[1]~char
    print STDERR "$_[1]";
    (($_[0] % 50) == 0) && (print STDERR "[".&fill_left($_[0],6,"0")."]\n");
} # counter
#
sub counter_end { # $_[0]~current_pos   $_[1]~char
    (($_[0] % 50) != 0) && (print STDERR "[".&fill_left($_[0],6,"0")."]\n");
} # counter_end
#line 759 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
#
sub max() {
    my $z = shift @_;
    foreach my $l (@_) { $z = $l if $l > $z };
    return $z;
} # max
sub min() {
    my $z = shift @_;
    foreach my $l (@_) { $z = $l if $l < $z };
    return $z;
} # min
#line 723 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub timing() {
    push @Timer, (new Benchmark);
    # partial time 
    $_[0] || 
        (return timestr(timediff($Timer[$#Timer],$Timer[($#Timer - 1)])));
    # total time
    return timestr(timediff($Timer[$#Timer],$Timer[0]));
} # timing
#line 808 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub report() { print STDERR sprintf($Messages{ shift @_ },@_) }
#line 814 "/home/ug/jabril/development/softjabril/multigeneplots/multigeneplots.nw"
sub warn() { print STDERR sprintf($Messages{ shift @_ }, @_) }
