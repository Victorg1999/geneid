% -*- mode: Noweb; noweb-code-mode: perl-mode; tab-width: 4 -*-
\documentclass[11pt]{article}
%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8
%
% # $Id: CHR22_tests.nw,v 1.4 2002-05-22 14:04:40 jabril Exp $ 
%
\usepackage{noweb}
\usepackage[a4paper,offset={0pt,0pt},hmargin={2cm,2cm},vmargin={1cm,1cm}]{geometry}
\usepackage{graphics}
\usepackage[dvips]{graphicx}
%% pstricks
\usepackage[dvips]{pstcol}
\usepackage{pstricks}
%\usepackage{pst-node}
%\usepackage{pst-char}
%\usepackage{pst-grad}
%% bibliography
\usepackage{natbib}
%% latex2html
\usepackage{url}
\usepackage{html}     
\usepackage{htmllist} 
%% tables    
\usepackage{dcolumn}
%\usepackage{colortbl}
%\usepackage{multirow}
%\usepackage{hhline}
%\usepackage{tabularx}
%% seminar
%\usepackage{semcolor,semlayer,semrot,semhelv,sem-page,slidesec}
%% draft watermark
%\usepackage[all,dvips]{draftcopy}
%\draftcopySetGrey{0.9}
%\draftcopyName{CONFIDENTIAL}{100}
%% layout
\usepackage{fancyhdr} % Do not use \usepackage{fancybox} -> TOCs disappear
%\usepackage{lscape}
\usepackage{rotating}
%\usepackage{multicol}
\usepackage{verbatim}
%\usepackage{version}
%% fonts
\usepackage{times}\fontfamily{ptm}\selectfont
\usepackage{t1enc}

% noweb options
\noweboptions{smallcode}
\def\nwendcode{\endtrivlist \endgroup} % relax page breaking scheme
\let\nwdocspar=\par                    %

\input defs.tex % from <LaTeX new definitions> chunk

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\begin{document}

<<HIDE: LaTeX new definitions>>=
%%%%% Colors for gff2ps
\input ColorDefs.tex

%%%%% New Commands are defined here
\newcommand{\sctn}[1]{\section{#1}}
\newcommand{\subsctn}[1]{\subsection{#1}}
\newcommand{\subsubsctn}[1]{\subsubsection{#1}}
\newcommand{\parsctn}[1]{\paragraph{#1}}
\newcommand{\desc}[1]{\item[#1] \ \\}
\newcommand{\todo}[1]{
  \vskip 3ex
  \hspace{-0.75cm}
   \psframebox[framearc=0.2,linecolor=darkred,linewidth=1pt,
              fillstyle=solid,fillcolor=verylightyellow,framesep=2ex]{
     \begin{minipage}[t]{16cm}
     \vskip -4.75ex
     \hspace{-1.25cm}
       \psframebox[framearc=1,linecolor=darkred,linewidth=1.25pt,
               fillstyle=solid,fillcolor=verylightorange,framesep=5pt]{
               \textcolor{darkred}{\textbf{\hspace{2ex}TO DO\hspace{2ex}}}
         } % psframebox
      \begin{itemize}\setlength{\itemsep}{-0.5ex} #1 \end{itemize}
     \end{minipage}
     } % psframebox
  \vskip 1.5ex
} % newcommand todo
\newcommand{\todoitem}[2]{
  \item[$\triangleright$] [\textit{Section}~\ref{#2}, 
                           \textit{page}~\pageref{#2}]\\ {#1}
} % newcommand todoitem
<<HIDE: new LaTeX commands>>

%%%%% PSTRICKs definitions
\pslongbox{ExFrame}{\psframebox}
\newcommand{\cln}[1]{\fcolorbox{black}{#1}{\textcolor{#1}{\rule[-.3ex]{1cm}{1ex}}}}
\newpsobject{showgrid}{psgrid}{subgriddiv=0,griddots=1,gridlabels=6pt}
% \pscharpath[fillstyle=solid, fillcolor=verydarkcyan, linecolor=black, linewidth=1pt]{\sffamily\scshape\bfseries\veryHuge #1 }
<<HIDE: new LaTeX pstricks>>

%%%%% global urls
% \newcommand{\getpsf}[1]{\html{(\htmladdnormallink{Get PostScript file}{./Psfiles/#1})}}   
<<HIDE: new LaTeX urls>>

%%%%% defs
\def\noweb{\textsc{noweb}}
\def\ps{\textsc{PostScript}}
<<HIDE: new LaTeX definitions>>

%%%%% TODO defs
<<HIDE: new defs TODO>>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\def\genomelab{\textbf{Genome Informatics Research Lab}}
\def\shorttit{\textbf{Human + Mouse}}
\def\tit{\textsc{\shortstack{Human Genome Annotation\\using Mouse Homology}}}
%
\def\mtauthor{
 \htmladdnormallink{\texttt{author@imim.es}}
                   {MAILTO:author@imim.es?subject=[humus]}
 } % def mtauthor
%
\def\authorslist{
 The Author/s {\mdseries\small\dotfill \mtauthor } \\
 % Other authors here...\\
 } % def authorslist
\def\authorshort{
 Abril, JF; Parra, G; Guig\'o, R
 } % def authorshort
%
\def\license{GNU General Public License (GNU-GPL)}
%
\def\progdesc{
We are going to scale up all the processes we have tested on {\lhsap} chromosomes 22 and 21, to the whole genome approach, in which we take advantage of the homology between {\hsap} and {\lmmus} genomes to increase gene prediction accuracy and producing a better genome annotation of the coding regions.
 } % def progdesc
%
\def\showaffiliation{
\scalebox{0.9 1}{\Large\textsl{\genomelab}}\\
Grup de Recerca en Infom\`atica Biom\`edica\\
Institut Municipal d'Investigaci\'o M\`edica\\
Universitat Pompeu Fabra\\[2ex]
 } % def showaffiliation
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% Setting text for footers and headers
\fancyhead{} % clear all fields
\fancyfoot{} % clear all fields
\fancyhead[RO,LE]{\thepage}
\fancyhead[LO,RE]{\shorttit\quad\rightmark}
\fancyfoot[LO,LE]{\small\textbf{\genomelab}}
\fancyfoot[CO,CE]{\small\textsl{\authorshort}}
\fancyfoot[RO,RE]{\small\textbf{\today}}
\renewcommand{\headrulewidth}{1pt}
\renewcommand{\footrulewidth}{1pt}
%
@

<<HIDE: new LaTeX commands>>=
\newcommand{\mylst}[2]{
 \begin{center}
% \fbox{
  \begin{minipage}{0.95\linewidth}
   \textbf{#1}
   \begin{itemize}
     #2
   \end{itemize}
  \end{minipage}
% } % fbox
 \end{center}
} % newcommand->mylst
\newcommand{\whtlst}[1]{\mylst{What to do here:}{#1}} % newcommand->chklst
\newcommand{\chklst}[1]{\mylst{Check points:}{#1}} % newcommand->chklst
@ 
<<HIDE: new LaTeX pstricks>>=
@ 
<<HIDE: new LaTeX urls>>=
\def\mtjabril{\htmladdnormallink{\textbf{jabril@imim.es}}{MAILTO:jabril@imim.es?subject=[HuMus]}}
\def\mtgparra{\htmladdnormallink{\textbf{gparra@imim.es}}{MAILTO:gparra@imim.es?subject=[HuMus]}}
\def\mtrguigo{\htmladdnormallink{\textbf{rguigo@imim.es}}{MAILTO:rguigo@imim.es?subject=[HuMus]}}
\def\mthomology{\htmladdnormallink{\textbf{homology@viaken.com}}{MAILTO:homology@viaken.com?subject=[HuMus]}}
@ 
<<HIDE: new LaTeX definitions>>=
\def\perl{\textsc{Perl}}
\def\biop{\textsc{BioPerl}}
\def\ps{\textsc{PostScript}}
\def\rptm{\textsc{RepeatMasker}}
\def\bl{\textsc{Blast}}
\def\bn{\textsc{blastn}}
\def\bx{\textsc{blastx}}
\def\bp{\textsc{blastp}}
\def\tbn{\textsc{tblastn}}
\def\tbx{\textsc{tblastx}}
\def\pb{\texttt{parseblast}}
\def\gnid{\texttt{geneid}}
\def\gnsc{\texttt{genscan}}
\def\twsc{\texttt{twinscan}}
\def\slam{\textsc{slam}}
\def\sgp{\textsc{sgp}}
\def\gps{\texttt{gff2ps}}
\def\aps{\texttt{gff2aplot}}
\def\apo{\textsl{Apollo}}
\def\refseq{\textsc{RefSeq}}
\def\ens{\textit{\texttt{emsembl}}}
\def\hsap{\textit{H. sapiens}}
\def\lhsap{\textit{Homo sapiens}}
\def\mmus{\textit{M. musculus}}
\def\lmmus{\textit{Mus musculus}}
@ 
<<HIDE: new defs TODO>>=
@ 

%

\thispagestyle{empty}

\begin{titlepage}

\ \vfill
\begin{center}
\textbf{\Huge \tit}\\[5ex]

% \textbf{\Large Authors List Here}\\[1ex]
\textbf{\Large Josep F. Abril}\\[1ex]
\textbf{\Large Gen\'{\i}s Parra}\\[1ex]
\textbf{\Large Roderic Guig\'o}\\[5ex] % \raisebox{0.85ex}{\footnotesize$\,\dag$}\\[0.5ex]

\textbf{\large --- \today ---}\\[10ex]

\begin{abstract}
\begin{center}
\parbox{0.75\linewidth}{
\progdesc
} % parbox
\end{center}
\end{abstract}

\vfill

\begin{raggedleft}
\showaffiliation
\raisebox{0.85ex}{\footnotesize$\dag\,$}{\large e-mail: {\mtjabril}, {\mtgparra} and {\mtrguigo}}\\
\end{raggedleft}
\end{center}

\end{titlepage} %'

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty}

\ \ \\
% EMPTY PAGE

%
%%%%%%%%%%%%%%%%%%%% FRONTMATTER

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pagenumbering{roman}
\setcounter{page}{1}
\pagestyle{fancy}
% Marks redefinition must go here because pagestyle 
% resets the values to the default ones.
\renewcommand{\sectionmark}[1]{\markboth{}{\thesection.\ #1}}
\renewcommand{\subsectionmark}[1]{\markboth{}{\thesubsection.\ \textsl{#1}}}

\tableofcontents
\listoftables
\listoffigures

\vfill
\begin{center}
{\small$<$ \verb$Id: CHR22_tests.nw,v 1.4 2002-05-22 14:04:40 jabril Exp $$>$ }
\end{center}

%%%%%%%%%%%%%%%%%%%% MAINMATTER

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagenumbering{arabic}
\setcounter{page}{1}

\sctn{Summary of results on Chromosome 22}

\subsctn{Adding evidences to SGP (I)}

Here, we pass same evidences as they were defined for the evaluation process, without any further filtering/processing.

\begin{comment}
### CHR 22 :  chr22 # Length 47848585 bp #########################
           PROGRAM  TESTSET         NuR         NuP     SN     SP     CC       ExR       ExP       TPe       ME        WE   raME   raWE    SNe    SPe   SNSP      GeR      GeP     TPg      MG       WG  raMG   raWG    SNg    SPg  SNSPg   raJG   raSG
###
           GENSCAN   REFSEQ      448782     1436803  0.922  0.288  0.512      2676      8080      2016      256      5662  0.096  0.701  0.753  0.250  0.502      327     1169      37      20      851 0.061  0.728  0.113  0.032  0.073  1.100  1.145
            GENEID   REFSEQ      448782     1148454  0.884  0.346  0.550      2676      5843      1955      360      3536  0.135  0.605  0.731  0.335  0.533      327     1092      55      21      765 0.064  0.701  0.168  0.050  0.109  1.065  1.140
        SGP-MGSCv3   REFSEQ      448782      792746  0.877  0.497  0.658      2676      4658      1986      288      2267  0.108  0.487  0.742  0.426  0.584      327      729      56      25      397 0.076  0.545  0.171  0.077  0.124  1.060  1.165
 SGP-MGSCv3+RefSeq   REFSEQ      448782      603017  0.603  0.449  0.518      2676      3329      1157     1160      1817  0.433  0.546  0.432  0.348  0.390      327      766      72      45      373 0.138  0.487  0.220  0.094  0.157  1.020  1.400
###
           GENSCAN  ENSEMBL      639229     1436803  0.899  0.400  0.596      3633      8080      2329      370      4838  0.102  0.599  0.641  0.288  0.465      573     1169       2      53      680 0.092  0.582  0.003  0.002  0.003  1.175  1.110
            GENEID  ENSEMBL      639229     1148454  0.833  0.464  0.618      3633      5843      2158      599      2836  0.165  0.485  0.594  0.369  0.481      573     1092       1      65      598 0.113  0.548  0.002  0.001  0.002  1.160  1.125
        SGP-MGSCv3  ENSEMBL      639229      792746  0.808  0.651  0.723      3633      4658      2166      534      1569  0.147  0.337  0.596  0.465  0.530      573      729       1      81      242 0.141  0.332  0.002  0.001  0.002  1.150  1.135
 SGP-MGSCv3+RefSeq  ENSEMBL      639229      603017  0.599  0.635  0.614      3633      3329      1309     1457      1162  0.401  0.349  0.360  0.393  0.377      573      766       1     130      224 0.227  0.292  0.002  0.001  0.002  1.070  1.300
###
\end{comment}
\begin{sidewaystable}
\begin{center}
\begin{tabular}{|r|*{5}{r}|*{8}{r}|*{8}{r}|rr|}
\hline
           PROGRAM &    NuR &     NuP &    SN &    SP &    CC &  ExR &  ExP &  TPe &  raME &  raWE &   SNe &   SPe &  SNSP & GeR &  GeP & TPg &  raMG &  raWG &   SNg &   SPg & SNSPg &  raJG &  raSG \\
\hline\hline
\multicolumn{24}{|l|}{REFSEQ}\\\hline
           GENSCAN & 448782 & 1436803 & 0.922 & 0.288 & 0.512 & 2676 & 8080 & 2016 & 0.096 & 0.701 & 0.753 & 0.250 & 0.502 & 327 & 1169 &  37 & 0.061 & 0.728 & 0.113 & 0.032 & 0.073 & 1.100 & 1.145 \\
            GENEID & 448782 & 1148454 & 0.884 & 0.346 & 0.550 & 2676 & 5843 & 1955 & 0.135 & 0.605 & 0.731 & 0.335 & 0.533 & 327 & 1092 &  55 & 0.064 & 0.701 & 0.168 & 0.050 & 0.109 & 1.065 & 1.140 \\
        SGP-MGSCv3 & 448782 &  792746 & 0.877 & 0.497 & 0.658 & 2676 & 4658 & 1986 & 0.108 & 0.487 & 0.742 & 0.426 & 0.584 & 327 &  729 &  56 & 0.076 & 0.545 & 0.171 & 0.077 & 0.124 & 1.060 & 1.165 \\
 SGP-MGSCv3+RefSeq & 448782 &  603017 & 0.603 & 0.449 & 0.518 & 2676 & 3329 & 1157 & 0.433 & 0.546 & 0.432 & 0.348 & 0.390 & 327 &  766 &  72 & 0.138 & 0.487 & 0.220 & 0.094 & 0.157 & 1.020 & 1.400 \\
\hline
\multicolumn{24}{|l|}{ENSEMBL}\\\hline
           GENSCAN & 639229 & 1436803 & 0.899 & 0.400 & 0.596 & 3633 & 8080 & 2329 & 0.102 & 0.599 & 0.641 & 0.288 & 0.465 & 573 & 1169 &   2 & 0.092 & 0.582 & 0.003 & 0.002 & 0.003 & 1.175 & 1.110 \\
            GENEID & 639229 & 1148454 & 0.833 & 0.464 & 0.618 & 3633 & 5843 & 2158 & 0.165 & 0.485 & 0.594 & 0.369 & 0.481 & 573 & 1092 &   1 & 0.113 & 0.548 & 0.002 & 0.001 & 0.002 & 1.160 & 1.125 \\
        SGP-MGSCv3 & 639229 &  792746 & 0.808 & 0.651 & 0.723 & 3633 & 4658 & 2166 & 0.147 & 0.337 & 0.596 & 0.465 & 0.530 & 573 &  729 &   1 & 0.141 & 0.332 & 0.002 & 0.001 & 0.002 & 1.150 & 1.135 \\
 SGP-MGSCv3+RefSeq & 639229 &  603017 & 0.599 & 0.635 & 0.614 & 3633 & 3329 & 1309 & 0.401 & 0.349 & 0.360 & 0.393 & 0.377 & 573 &  766 &   1 & 0.227 & 0.292 & 0.002 & 0.001 & 0.002 & 1.070 & 1.300 \\
\hline
\end{tabular}
\end{center}
\end{sidewaystable}

\subsctn{Adding evidences to SGP (II)}

In this case, we remove the frame information from the RefSeq features, just to test if {\gnid} incorporates evidences in a better way.

\begin{table}
\begin{center}
\begin{tabular}{|r|*{5}{r}|*{8}{r}|*{8}{r}|rr|}
\end{tabular}
\end{center}
\end{table}

\subsctn{Adding evidences to SGP (III)}

Now, we are ``hiding'' the refseq genes by projecting them as single exons, as the previous approach did not work very well. We lost almost all the predictions not matching already annotated genes (due to the way {\gnid} incorporates evidences with no frame having lengths that are not multiple of 3). We follow these steps:

\begin{itemize}
\item Retrieve start and end for all the annotated genes ([[get_geneid_genes]] bash function).
\item Map all genes to a single strand (FWD).
\item Project them as if they were SRs ([[blast2gff]] program).
\item Join those projections having less than 500 nucleotides of intergenic space between them.
\item Check the final ``singletons'' to have $ (\mbox{gene}_{\mbox{length}} \bmod 3 == 0 $ and correct length for those not acomplishing that condition (by adding the corresponding $3 - (\mbox{gene}_\mbox{length} \bmod 3$)).
\end{itemize}

\begin{table}
\begin{center}
\begin{tabular}{|r|*{5}{r}|*{8}{r}|*{8}{r}|rr|}
\end{tabular}
\end{center}
\end{table}

\newpage %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\sctn{Tests made on Chromosome 22}

\subsctn{Adding evidences to SGP (I)}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsctn{Initialization}

<<Running CHR22: SGP HsapGP + MmusMGSC + RefSeq>>=
OXID="20011222.UCSCgp-20020411.MGSCv3" ;
NXID="20011222.UCSCgp-20020411.MGSCv3+RefSeq" ;
CHR="22" ;
NCHR="chr$CHR" ;
SEQ="chr22" ;
HOMOLOGY="$HUMUS/$NCHR/sgp/$OXID/hsp-sr/$SEQ.gff" ;
# remember that geneid does not allow overlapping features... :^<
EVIDENCE="$HUMUS/$NCHR/annotation/20011222/refseq/$SEQ.eval.gff" ;
ODIR="$HUMUS/$NCHR/sgp/$NXID" ;
#
MkDirs $ODIR ;
for c in out gff gtf2 cds prot hsp-sr logs tmp eval ;
  do { 
    MkDirs $ODIR/$c ;
    } ;
  done ;
#
@ 

\subsubsctn{Running {\sgp}}

<<>>=
#
GENEID="$SRC/geneid_v1.1-sgp/bin/geneid" ; # geneid v1.1-sgp
PARAM="$SRC/geneid_v1.1-sgp/param/human3iso.param.sgp" ;
EW=0 ; # add to exon weigth
#
#--> we do not run geneid on masked sequences at this moment
#--> we are using original un-masked fasta sequences from GP
ISEQ="$HSEQ/$SEQ.fa" ;
#
if [ -f "$HOMOLOGY" ] ;
  then
    echo "### Using homology data from: $HOMOLOGY" 1>&2 ;
    HOMOLOGY_PAR="-S $HOMOLOGY" ;
  else
    echo "### Homology file NOT found: $HOMOLOGY" 1>&2 ;
    HOMOLOGY_PAR="" ;
  fi ;
#
if [ -f "$EVIDENCE" ] ;
  then
    echo "### Using termini file: $EVIDENCE" 1>&2 ;
    sort +3n -4 $EVIDENCE > $ODIR/tmp/$SEQ.gff ;
    EVIDENCE_PAR="-R $ODIR/tmp/$SEQ.gff" ;
  else
    EVIDENCE_PAR="" ;
  fi ;
#
CheckFile R $PARAM $ISEQ $HOMOLOGY $EVIDENCE ;
#
GENEID_CMDLN="-v -DE $EW -P $PARAM $HOMOLOGY_PAR $EVIDENCE_PAR $ISEQ" ;
echo "$GENEID $GENEID_CMDLN 2> $ODIR/$SEQ.sgp" 1>&2 ;
$GENEID $GENEID_CMDLN 2> $ODIR/logs/$SEQ.sgp > $ODIR/out/$SEQ.all ;
grep -v 'evidence' $ODIR/out/$SEQ.all > $ODIR/out/$SEQ ;
$BIN/geneid_raw2GFF.pl $SEQ $ODIR $ODIR/out/$SEQ ;
#
ls -1 $ODIR/gff/$SEQ.sg/ | egrep "^$SEQ" | \
  while read n;
    do {
      cat $ODIR/gff/$SEQ.sg/$n;
      };
    done | sort +3n +4n -5 - > $ODIR/gff/$SEQ ;
#
get_geneid_genes $ODIR/gff/$SEQ > $ODIR/$SEQ.gene_list ;
#
@ 

\subsubsctn{Evaluating predictions}

<<>>=
#
gawk '$3~/^(Single|First|Internal|Terminal)$/ {print $0}' \
               $ODIR/gff/$SEQ > $ODIR/eval/$SEQ.eval.gff ;
#
VDIR="$ODIR/eval" ;
$BIN/gffsplitstrand.pl $VDIR/$SEQ.eval.gff ; # no sequence length record required here
#
A_REFSEQ="$HUMUS/$NCHR/annotation/20011222/refseq/$SEQ.eval" ;
A_ENSEMBL="$HUMUS/$NCHR/annotation/20011222/ensembl/$SEQ.eval" ;
#
A_GENEID="$HUMUS/$NCHR/geneid/20011222/eval/$SEQ.eval" ;
A_GENSCAN="$HUMUS/$NCHR/annotation/20011222/genscan/eval/$SEQ.eval" ;
A_SGP="$HUMUS/$NCHR/sgp/20011222.UCSCgp-20020411.MGSCv3/eval/$SEQ.eval" ;
#
cat > $VDIR/${SEQ}.ALL.summary <<EOT ;
#
# Evaluation summary results for SGP on CHROM[$CHR] - SEQ[$SEQ]
#
# --> Hsap GP20011222 x Mmus MGSCv3 homology + Hsap RefSeq GP20011222 evidences
#
EOT
#
CheckFile R $A_REFSEQ.fwd.gff  $A_REFSEQ.rev.gff  \
            $A_ENSEMBL.fwd.gff $A_ENSEMBL.rev.gff ;
####
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_GENSCAN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_GENEID.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_SGP.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $VDIR/$SEQ.eval.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_refseq.fwd ;
#
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_GENSCAN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_GENEID.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_SGP.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $VDIR/$SEQ.eval.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_refseq.rev ;
####
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_GENSCAN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_GENEID.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_SGP.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $VDIR/$SEQ.eval.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_ensembl.fwd ;
#
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_GENSCAN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_GENEID.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_SGP.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $VDIR/$SEQ.eval.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_ensembl.rev ;
####
enscript -1r -Gjf Courier5 -M A4 $VDIR/${SEQ}.ALL.summary ;
# -tas
$BIN/process_eval.pl -t -T "REFSEQ ENSEMBL" \
   -P "GENSCAN GENEID SGP-MGSCv3 SGP-MGSCv3+RefSeq"  \
   $VDIR/${SEQ}.ALL.summary > $VDIR/${SEQ}.ALL.test_summary ;
enscript -1r -Gjf Courier5 -M A4 $VDIR/${SEQ}.ALL.test_summary ;
#
@ 

\subsctn{Adding evidences to SGP (II)}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsctn{Initialization}

<<Running CHR22: SGP HsapGP + MmusMGSC + noframe-RefSeq>>=
OXID="20011222.UCSCgp-20020411.MGSCv3" ;
NXID="20011222.UCSCgp-20020411.MGSCv3+RefSeq.NoFrame" ;
CHR="22" ;
NCHR="chr$CHR" ;
SEQ="chr22" ;
HOMOLOGY="$HUMUS/$NCHR/sgp/$OXID/hsp-sr/$SEQ.gff" ;
# remember that geneid does not allow overlapping features... :^<
EVIDENCE="$HUMUS/$NCHR/annotation/20011222/refseq/$SEQ.eval.gff" ;
ODIR="$HUMUS/$NCHR/sgp/$NXID" ;
#
MkDirs $ODIR ;
for c in out gff gtf2 cds prot hsp-sr logs tmp eval ;
  do { 
    MkDirs $ODIR/$c ;
    } ;
  done ;
#
@ 

\subsubsctn{Running {\sgp}}

<<>>=
#
GENEID="$SRC/geneid_v1.1-sgp/bin/geneid" ; # geneid v1.1-sgp
PARAM="$SRC/geneid_v1.1-sgp/param/human3iso.param.sgp" ;
EW=0 ; # add to exon weigth
#
#--> we do not run geneid on masked sequences at this moment
#--> we are using original un-masked fasta sequences from GP
ISEQ="$HSEQ/$SEQ.fa" ;
#
if [ -f "$HOMOLOGY" ] ;
  then
    echo "### Using homology data from: $HOMOLOGY" 1>&2 ;
    HOMOLOGY_PAR="-S $HOMOLOGY" ;
  else
    echo "### Homology file NOT found: $HOMOLOGY" 1>&2 ;
    HOMOLOGY_PAR="" ;
  fi ;
#
if [ -f "$EVIDENCE" ] ;
  then
    echo "### Using termini file: $EVIDENCE" 1>&2 ;
    sort +3n -4 $EVIDENCE | \
      gawk 'BEGIN{ OFS="\t" }
         ($0 !~ /^[ \t]*$/ && $1 !~ /^\#/) { 
             $8="."; print $0 }' > $ODIR/tmp/$SEQ.gff ;
    EVIDENCE_PAR="-R $ODIR/tmp/$SEQ.gff" ;
  else
    EVIDENCE_PAR="" ;
  fi ;
#
CheckFile R $PARAM $ISEQ $HOMOLOGY $EVIDENCE ;
#
GENEID_CMDLN="-v -DE $EW -P $PARAM $HOMOLOGY_PAR $EVIDENCE_PAR $ISEQ" ;
echo "$GENEID $GENEID_CMDLN 2> $ODIR/$SEQ.sgp" 1>&2 ;
$GENEID $GENEID_CMDLN 2> $ODIR/logs/$SEQ.sgp > $ODIR/out/$SEQ.all ;
grep -v 'evidence' $ODIR/out/$SEQ.all > $ODIR/out/$SEQ ;
$BIN/geneid_raw2GFF.pl $SEQ $ODIR $ODIR/out/$SEQ ;
#
ls -1 $ODIR/gff/$SEQ.sg/ | egrep "^$SEQ" | \
  while read n;
    do {
      cat $ODIR/gff/$SEQ.sg/$n;
      };
    done | sort +3n +4n -5 - > $ODIR/gff/$SEQ ;
#
get_geneid_genes $ODIR/gff/$SEQ > $ODIR/$SEQ.gene_list ;
#
@ 

\subsubsctn{Evaluating predictions}

<<>>=
#
gawk '$3~/^(Single|First|Internal|Terminal)$/ {print $0}' \
               $ODIR/gff/$SEQ > $ODIR/eval/$SEQ.eval.gff ;
#
VDIR="$ODIR/eval" ;
$BIN/gffsplitstrand.pl $VDIR/$SEQ.eval.gff ; # no sequence length record required here
#
A_REFSEQ="$HUMUS/$NCHR/annotation/20011222/refseq/$SEQ.eval" ;
A_ENSEMBL="$HUMUS/$NCHR/annotation/20011222/ensembl/$SEQ.eval" ;
cat > $VDIR/${SEQ}.ALL.summary <<EOT ;
#
# Evaluation summary results for SGP on CHROM[$CHR] - SEQ[$SEQ]
#
# --> Hsap GP20011222 x Mmus MGSCv3 homology + Hsap RefSeq GP20011222 evidences (Without Frame info, set as '.')
#
EOT
#
CheckFile R $A_REFSEQ.fwd.gff  $A_REFSEQ.rev.gff  \
            $A_ENSEMBL.fwd.gff $A_ENSEMBL.rev.gff ;
#
$BIN/runeval.pl $A_REFSEQ.fwd.gff $VDIR/$SEQ.eval.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $VDIR/$SEQ.eval.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_refseq.rev ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $VDIR/$SEQ.eval.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $VDIR/$SEQ.eval.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.sgp_ensembl.rev ;
#
enscript -1r -Gjf Courier5 -M A4 $VDIR/${SEQ}.ALL.summary ;
# -tas
$BIN/process_eval.pl -t -T "REFSEQ ENSEMBL" \
   -P "GENSCAN GENEID SGP-MGSCv3 SGP-MGSCv3+RefSeq"  \
   $VDIR/${SEQ}.ALL.summary > $VDIR/${SEQ}.ALL.test_summary ;
enscript -1r -Gjf Courier5 -M A4 $VDIR/${SEQ}.ALL.test_summary ;
#
@ 


\subsctn{Adding evidences to SGP (III)}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsctn{Initialization}

<<Running CHR22: SGP HsapGP + MmusMGSC + noframe-RefSeq>>=
OXID="20011222.UCSCgp-20020411.MGSCv3" ;
NXID="20011222.UCSCgp-20020411.MGSCv3+RefSeq.Singles" ;
CHR="22" ;
NCHR="chr$CHR" ;
SEQ="chr22" ;
HOMOLOGY="$HUMUS/$NCHR/sgp/$OXID/hsp-sr/$SEQ.gff" ;
# remember that geneid does not allow overlapping features... :^<
EVIDIR="$HUMUS/$NCHR/annotation/20011222/refseq" ;
# EVIDENCE="$EVIDIR/$SEQ.eval.gff" ;
ODIR="$HUMUS/$NCHR/sgp/$NXID" ;
EVIDENCE="$ODIR/evids/$SEQ.evids.gff" ;
#
MkDirs $ODIR ;
for c in out gff gtf2 cds prot hsp-sr logs tmp eval evids ;
  do { 
    MkDirs $ODIR/$c ;
    } ;
  done ;
@ 

\subsubsctn{Processing evidences}

<<>>=
#
################################################## BUILDING 'SINGLETONS'
#
# Get gene start-end
get_geneid_genes $EVIDIR/$SEQ.fullgff > $EVIDIR/$SEQ.genes.full ;
#
# Map to single strand and save in GFF format
gawk 'BEGIN{ OFS="\t";
             chr=ARGV[1]; ARGV[1]="";
             source="refseq"; feat="single"; sco="1"; strand="+"; frame="3" }
  ($0 !~ /^[ \t]*$/ && $1 !~ /^\#/) {
      print chr,source,feat,$2,$3,sco,strand,frame,$1; # strand->$4
  }' $SEQ $EVIDIR/$SEQ.genes.full | sort +3n -4 > $EVIDIR/$SEQ.genes.gff ;
# 
# Project "singletons"
$BIN/blast2gff -vg $EVIDIR/$SEQ.genes.gff > $ODIR/evids/$SEQ.genes.gff ;
#
# Check for intergenic less than 500bp and for gene length multiple of 3
$BIN/prepevids.pl 500 $ODIR/evids/$SEQ.genes.gff | sort +3n -4 > $ODIR/evids/$SEQ.evids.gff ;
##################################################
#  349    3141   18846  $EVIDIR/chr22.genes.gff
#  282    2249   14046  $ODIR/evids/chr22.genes.gff
#  279    2511   14400  $ODIR/evids/chr22.evids.gff
#  910    7901   47292  total 
@ 

\subsubsctn{Running {\sgp}}

<<>>=
#
GENEID="$SRC/geneid_v1.1-sgp/bin/geneid" ; # geneid v1.1-sgp
PARAM="$SRC/geneid_v1.1-sgp/param/human3iso.param.sgp" ;
EW=0 ; # add to exon weigth
#
#--> we do not run geneid on masked sequences at this moment
#--> we are using original un-masked fasta sequences from GP
ISEQ="$HSEQ/$SEQ.fa" ;
#
if [ -f "$HOMOLOGY" ] ;
  then
    echo "### Using homology data from: $HOMOLOGY" 1>&2 ;
    HOMOLOGY_PAR="-S $HOMOLOGY" ;
  else
    echo "### Homology file NOT found: $HOMOLOGY" 1>&2 ;
    HOMOLOGY_PAR="" ;
  fi ;
#
if [ -f "$EVIDENCE" ] ;
  then
    echo "### Using termini file: $EVIDENCE" 1>&2 ;
    # sort +3n -4 $EVIDENCE | \
    #   gawk 'BEGIN{ OFS="\t" }
    #      ($0 !~ /^[ \t]*$/ && $1 !~ /^\#/) { 
    #          $8="."; print $0 }' > $ODIR/tmp/$SEQ.gff ;
    # EVIDENCE_PAR="-R $ODIR/tmp/$SEQ.gff" ;
    EVIDENCE_PAR="-R $EVIDENCE" ;
  else
    EVIDENCE_PAR="" ;
  fi ;
#
CheckFile R $PARAM $ISEQ $HOMOLOGY $EVIDENCE ;
#
GENEID_CMDLN="-v -DE $EW -P $PARAM $HOMOLOGY_PAR $EVIDENCE_PAR $ISEQ" ;
echo "$GENEID $GENEID_CMDLN > $ODIR/out/$SEQ.all 2> $ODIR/$SEQ.sgp" 1>&2 ;
$GENEID $GENEID_CMDLN > $ODIR/out/$SEQ.all 2> $ODIR/logs/$SEQ.sgp  ;
egrep -v '^Annotation' $ODIR/out/$SEQ.all > $ODIR/out/$SEQ ;
$BIN/geneid_raw2GFF.pl $SEQ $ODIR $ODIR/out/$SEQ ;
#
ls -1 $ODIR/gff/$SEQ.sg/ | egrep "^$SEQ" | \
  while read n;
    do {
      cat $ODIR/gff/$SEQ.sg/$n;
      };
    done | sort +3n +4n -5 - > $ODIR/gff/$SEQ ;
#
get_geneid_genes $ODIR/gff/$SEQ > $ODIR/$SEQ.gene_list ;
#
@ 

\subsubsctn{Evaluating predictions and comparing with previous results}

<<>>=
#
gawk 'BEGIN{OFS="\t"} $1!~/^\#/ {$6=500; print $0}' $EVIDIR/$SEQ.eval.gff | \
    cat - $ODIR/gff/$SEQ | egrep -v '^#' - | \
    sort +3n -4 - > $ODIR/gff/$SEQ.geneid+refseq
#
gawk '$3~/^(Single|First|Internal|Terminal)$/ {print $0}' \
     $ODIR/gff/$SEQ.geneid+refseq > $ODIR/eval/$SEQ.geneid+refseq.eval.gff ;
#
VDIR="$ODIR/eval" ;
$BIN/gffsplitstrand.pl $VDIR/$SEQ.geneid+refseq.eval.gff ; # no sequence length record required here
# cp $HUMUS/$NCHR/annotation/20011222/VictoriaHaghighi/vicky.cds.gff \
#    $HUMUS/$NCHR/annotation/20011222/VictoriaHaghighi/chr22.eval.gff
$BIN/gffsplitstrand.pl -l $HUMUS/$NCHR/annotation/20011222/length.$SEQ.gff \
    $HUMUS/$NCHR/annotation/20011222/VictoriaHaghighi/$SEQ.eval.gff
#
A_REFSEQ="$HUMUS/$NCHR/annotation/20011222/refseq/$SEQ.eval" ;
A_ENSEMBL="$HUMUS/$NCHR/annotation/20011222/ensembl/$SEQ.eval" ;
A_VICTORIA="$HUMUS/$NCHR/annotation/20011222/VictoriaHaghighi/$SEQ.eval" ;
#
A_GENEID="$HUMUS/$NCHR/geneid/20011222/eval/$SEQ.eval" ;
A_GENSCAN="$HUMUS/$NCHR/annotation/20011222/genscan/eval/$SEQ.eval" ;
A_SGP="$HUMUS/$NCHR/sgp/20011222.UCSCgp-20020411.MGSCv3/eval/$SEQ.eval" ;
A_SGPRKN="$HUMUS/$NCHR/sgp/20011222.UCSCgp-20020504.RIKEN/eval/$SEQ.eval" ;
A_SGPMGSCRKN="$HUMUS/$NCHR/sgp/20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN/eval/$SEQ.eval" ;
A_SRs="$HUMUS/$NCHR/tblastx/20020425/eval/$SEQ.eval" ;
A_SRsRKN="$HUMUS/$NCHR/tblastx/20020504.RIKEN/eval/$SEQ.eval" ;
A_SRsMGSCRKN="$HUMUS/$NCHR/sgp/20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN/hsp-sr/eval/$SEQ.eval" ;
#
cat > $VDIR/${SEQ}.ALL.summary <<EOT ;
#
# Evaluation summary results for SGP on CHROM[$CHR] - SEQ[$SEQ]
#
# --> Hsap GP20011222 x Mmus MGSCv3 homology + Hsap RefSeq GP20011222 evidences (passed as singles...)
#
EOT
#
CheckFile R $A_REFSEQ.fwd.gff   $A_REFSEQ.rev.gff   \
            $A_ENSEMBL.fwd.gff  $A_ENSEMBL.rev.gff  \
            $A_VICTORIA.fwd.gff $A_VICTORIA.rev.gff ;
####
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_GENSCAN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_GENEID.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_SGP.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_SGPRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SGP-RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_SGPMGSCRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SGP-MGSCv3+RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $VDIR/$SEQ.geneid+refseq.eval.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_SRs.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SRs-MGSCv3::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_SRsRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SRs-RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
$BIN/runeval.pl $A_REFSEQ.fwd.gff $A_SRsMGSCRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::FWD::SRs-MGSCv3+RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.fwd ;
#
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_GENSCAN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_GENEID.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_SGP.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_SGPRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SGP-RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_SGPMGSCRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SGP-MGSCv3+RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $VDIR/$SEQ.geneid+refseq.eval.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_SRs.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SRs-MGSCv3::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_SRsRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SRs-RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
$BIN/runeval.pl $A_REFSEQ.rev.gff $A_SRsMGSCRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::REFSEQ::REV::SRs-MGSCv3+RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_refseq.rev ;
####
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_GENSCAN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_GENEID.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_SGP.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_SGPRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SGP-RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_SGPMGSCRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SGP-MGSCv3+RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $VDIR/$SEQ.geneid+refseq.eval.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_SRs.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SRs-MGSCv3::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_SRsRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SRs-RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
$BIN/runeval.pl $A_ENSEMBL.fwd.gff $A_SRsMGSCRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::FWD::SRs-MGSCv3+RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.fwd ;
#
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_GENSCAN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_GENEID.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_SGP.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_SGPRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SGP-RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_SGPMGSCRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SGP-MGSCv3+RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $VDIR/$SEQ.geneid+refseq.eval.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_SRs.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SRs-MGSCv3::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_SRsRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SRs-RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
$BIN/runeval.pl $A_ENSEMBL.rev.gff $A_SRsMGSCRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::ENSEMBL::REV::SRs-MGSCv3+RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_ensembl.rev ;
####
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_GENSCAN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_GENEID.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_SGP.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_SGPRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::SGP-RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_SGPMGSCRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::SGP-MGSCv3+RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $VDIR/$SEQ.geneid+refseq.eval.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_SRs.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::SRs-MGSCv3::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_SRsRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::SRs-RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
$BIN/runeval.pl $A_VICTORIA.fwd.gff $A_SRsMGSCRKN.fwd.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::FWD::SRs-MGSCv3+RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.fwd ;
#
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_GENSCAN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::GENSCAN::GP::." \
    >> $VDIR/${SEQ}.ALL.summary 2> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_GENEID.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::GENEID::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_SGP.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::SGP-MGSCv3::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_SGPRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::SGP-RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_SGPMGSCRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::SGP-MGSCv3+RIKEN::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $VDIR/$SEQ.geneid+refseq.eval.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::SGP-MGSCv3+RefSeq::geneid_1.1::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_SRs.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::SRs-MGSCv3::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_SRsRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::SRs-RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
$BIN/runeval.pl $A_VICTORIA.rev.gff $A_SRsMGSCRKN.rev.gff                 \
    "${CHR}::${HSAPID}x${MMUSID}+RefSeq::VICTORIA::REV::SRs-MGSCv3+RIKEN::tblastx::." \
    >> $VDIR/${SEQ}.ALL.summary 2>> $VDIR/${SEQ}.ALL.sgp_victoria.rev ;
#
enscript -1r -Gjf Courier5 -M A4 $VDIR/${SEQ}.ALL.summary ;
# -tas
$BIN/process_eval.pl -t -T "REFSEQ ENSEMBL VICTORIA" \
   -P "GENSCAN GENEID SGP-MGSCv3 SGP-RIKEN SGP-MGSCv3+RIKEN SGP-MGSCv3+RefSeq SRs-MGSCv3 SRs-RIKEN SRs-MGSCv3+RIKEN"  \
   $VDIR/${SEQ}.ALL.summary > $VDIR/${SEQ}.ALL.test_summary ;
enscript -1r -Gjf Courier5 -M A4 $VDIR/${SEQ}.ALL.test_summary ;
#
@ 

\subsubsctn{Checking HSP-SRs obtained on chr22}

<<>>=
( echo "###";echo "### 20011222.UCSCgp-20020411.MGSCv3 "; cat sgp/20011222.UCSCgp-20020411.MGSCv3/hsp-sr/chr22.report; echo "###"; echo "### 20011222.UCSCgp-20020504.RIKEN "; cat sgp/20011222.UCSCgp-20020504.RIKEN/hsp-sr/chr22.report; echo "###"; echo "### 20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN (merged HSP-SRs)"; cat sgp/20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN/hsp-sr/chr22.merged.report; echo "###"; echo "### 20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN (HSP-SRs after projection of merged HSP-SRs)"; cat sgp/20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN/hsp-sr/chr22.report ) > chr22.eval.HSP-SRs
@ 
<<chr22.eval.HSP-SRs>>=
###
### 20011222.UCSCgp-20020411.MGSCv3
# TOTAL 25013 HSP-SRs on chr22: 12635 forward, 12378 reverse, 0 without strand.
#       +1 :   4182     |       -1 :   4175     |       .1 :      0
#       +2 :   4136     |       -2 :   4082     |       .2 :      0
#       +3 :   4317     |       -3 :   4121     |       .3 :      0
###
### 20011222.UCSCgp-20020504.RIKEN
# TOTAL 10584 HSP-SRs on chr22: 5285 forward, 5299 reverse, 0 without strand.
#       +1 :   1752     |       -1 :   1724     |       .1 :      0
#       +2 :   1716     |       -2 :   1771     |       .2 :      0
#       +3 :   1817     |       -3 :   1804     |       .3 :      0
###
### 20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN (merged HSP-SRs)
# TOTAL 35597 SRs on chr22: 17920 forward, 17677 reverse, 0 without strand.
#       +1 :   5934     |       -1 :   5899     |       .1 :      0
#       +2 :   5852     |       -2 :   5853     |       .2 :      0
#       +3 :   6134     |       -3 :   5925     |       .3 :      0
###
### 20011222.UCSCgp-20020411.MGSCv3+20020504.RIKEN (HSP-SRs after projection of merged HSP-SRs)
# TOTAL 26396 SRs on chr22: 13274 forward, 13122 reverse, 0 without strand.
#       +1 :   4411     |       -1 :   4398     |       .1 :      0
#       +2 :   4343     |       -2 :   4331     |       .2 :      0
#       +3 :   4520     |       -3 :   4393     |       .3 :      0
@ 

\sctn{Extracting documentation and \LaTeX{}'ing it} % \\[-0.5ex] %'

\subsctn{BASH scripts}

<<BASH shebang>>=
#!/usr/bin/bash
# GNU bash, version 2.03.6(1)-release (i386-redhat-linux-gnu)
<<Version Control Id Tag>>
@ 

<<BASH script start>>=
<<BASH shebang>>
#
SECONDS=0 # Reset Timing
# Which script are we running...
L="####################"
{ echo "$L$L$L$L";
  echo "### RUNNING [$0]";
  echo "### Current date:`date`";
  echo "###"; } 1>&2;
@

<<BASH script end>>=
{ echo "###"; echo "### Execution time for [$0] : $SECONDS secs";
  echo "$L$L$L$L";
  echo ""; } 1>&2;
#
exit 0
@

\subsctn{Version control tags}

This document is under Concurrent Versions System (CVS). The version you are currently reading is the following:

<<Version Control Id Tag>>=
# $Id: CHR22_tests.nw,v 1.4 2002-05-22 14:04:40 jabril Exp $
@ 

\subsctn{BASH variables}

<<BASH Environment Variables>>=
#
umask 002 ;
#
# Setting Global Variables
# WORK is set by "setcwd"
EDITOR="emacs";
WDIR="$WORK/lib" ;
DDIR="$WDIR/CHR22_tests.docs" ;
localnw="CHR22_tests" ;
export EDITOR WDIR DDIR localnw ;
#
function MkDirs ()
{
  #
  # USAGE: MkDirs <path_list>
  #
  for name in "$@" ;
    do {
         if [ -d "$name" ] ;
         then 
           echo "### Directory Already Exist: $name" 1>&2 ;
         elif mkdir $name 2> /dev/null ;
           then
             echo "### Making New Directory   : $name" 1>&2 ;
         else
           echo "### CANNOT Create Directory: $name" 1>&2 ; 
         fi ;
      } ;
    done ;
}
#
function is_exec ()
{
  #
  # USAGE: is_exec <filename_0>...<filename_N>
  for file in $@ ;
    do {
         if [ -x $file ] ;
         then
           echo "#    Script $file has execute permissions ..." 1>&2 ;
         else
           echo "#    Setting execute permissions for $file ..." 1>&2 ;
           chmod a+x $file 2> /dev/null ;
         fi ;
      } ;
    done ;
}
#
@

\subsctn{Tangling and weaving}

<<tangling complementary LaTeX files>>=
notangle -R"HIDE: LaTeX new definitions" $WDIR/$localnw.nw | \
    cpif $DDIR/defs.tex ;
notangle -R"HIDE: TODO" $WDIR/$localnw.nw | cpif $DDIR/todo.tex ; 
@ 

<<weaving>>=
<<BASH script start>>
# weaving and LaTeXing
<<BASH Environment Variables>>
#
MkDirs $WDIR $DDIR ;
#
<<tangling complementary LaTeX files>>
noweave -v -t4 -delay -x -filter 'elide "HIDE: *"' \
        $WDIR/$localnw.nw | cpif $DDIR/$localnw.tex ;
# noweave -t4 -delay -index $WDIR/$localnw.nw > $DDIR/$localnw.tex 
pushd $DDIR/ ;
#
echo "### RUNNING LaTeX on $localnw.tex" 1>&2 ;
latex $localnw.tex ; 
latex $localnw.tex ; 
latex $localnw.tex ;
dvips $localnw.dvi -o $localnw.ps -t a4 ;
#
# pdflatex $localnw.tex ;
# echo "### CONVERTING PS to PDF: $localnw" 1>&2 ;
# ps2pdf $localnw.ps $localnw.pdf ;
#
popd ;
<<BASH script end>>
@ %$

<<Get current document>>=
notangle -R'weaving' $WORK/lib/CHR22_tests.nw | bash
@ 

\end{document}
