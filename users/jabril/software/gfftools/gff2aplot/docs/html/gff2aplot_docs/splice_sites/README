CONSERVATION OF SPLICE SITES between HUMAN and MOUSE
rgs, imim, april 1999

0. Do it for pairs of homologous genes in embl-56.rod
BAL  HSCEL  RNCHOLEST
COXD  HSU66875  MM34801
ENOB  HSENO3  MMENO3G
H1T  HSHISH1T  MMHISTA
H4  HSHIS4  MMHIST4
HS71  HSHSP70D  RNHSP70  
KCRB  HSCKBG  MMCRKNB
MIF  HSMIF  MM20156
MT3  S72043  S72046
OSTP  HS207581  MMOESTEOP
PAP1  HSPAP1  MMD360
PSPA  HSSFTP1A  S48768
ROM1  HSROD1X  MMROM1X
RS7  HSRPS7 AF043285  
SPEE  HSSPERSYN  MMSPERSYN



A. Get GT sites in every sequence

1.1. Get GT Sites
./FindRegexp ...gt.... p embl-56.hl.humrod.tbl > embl-56.hl.humrod.GT

gawk '{for (i=2;i<NF;i+=2) print $i, $(i+1) > "Sites/" $1".GT"}'  embl-56.hl.humrod.GT


1.2. Get scored donor sites, using geneid (v3.0)
apolo 79% sh RunGeneid.sh < embl-56.hl.humrod.tbl

mv *.Donors Sites

1.3. Get only donor sites in GT file
sh aux1.sh < embl-56.hl.humrod.locus

2. Get Sites similarity between pairs of sequences
sh RunDsites.sh Dsites  < embl-56.hl.humrod

==> Pairwise scores in Sites/*.dist.GT

3. Make Aplots

Consider only more than 4 matches

join embl-56.hl.humrod.locus ../Conservation/embl-56.hl.vrt.length+cds | gawk '{locus=$1;len=$2;$1=$2=""; print locus, len, 0, $0}' > embl-56.hl.humrod.cds

sh 2aplot.sh < embl-56.hl.humrod
sh 2aplot.sh Sites dist.GT Aplot GT donors 2 6 9 4 <  embl-56.hl.humrod

1.1. Get GT Sites
./FindRegexp ..............ag. p embl-56.hl.humrod.tbl > embl-56.hl.humrod.AG

gawk '{for (i=2;i<NF;i+=2) print $i, $(i+1) > "Sites/" $1".AG"}'  embl-56.hl.humrod.AG


1.2. Get scored acceptor sites, using geneid (v3.0)
apolo 79% sh RunGeneid.sh < embl-56.hl.humrod.tbl

mv *.Acceptors Sites

1.3. Get only donor sites in GT file
sh auxAG.sh < embl-56.hl.humrod.locus

2. Get Sites similarity between pairs of sequences
sh RunDsites.sh Asites dist.AG  < embl-56.hl.humrod

==> Pairwise scores in Sites/*.dist.AG

Consider only more than 6 matches

sh 2aplotAG.sh < embl-56.hl.humrod
sh 2aplot.sh Sites dist.AG Aplot AG acceptors 16 0 17 6 <  embl-56.hl.humrod

--------------------------------------------------------------------------------
-------------------------------------------------------------------------------

Now, do the same thing considering only the score of the splice sites

1. GET TRUE SPLICE SITES 

join2 embl-56.hl.humrod.tbl embl-56.hl.humrod.cds | gawk '{for (i=6;i<NF;i+=2) print $1, $i, substr($2,$i-2,9)}' >  embl-56.hl.humrod.donors


join2 embl-56.hl.humrod.tbl embl-56.hl.humrod.cds | gawk '{for (i=7;i<NF;i+=2) print $1, $i, substr($2,$i-16,17)}' >  embl-56.hl.humrod.acceptors

It may not make a lot of sense, 
continue studying splice site conservation as in 
/home/rguigo/research/HUMUS/Conservation



----------------------------------------------------------------------
Get pairs of donor sites

1. donors
ExtractSites embl-56.hl.humrod.cds embl-56.hl.humrod.tbl ff=2 fs=2 off=-2 len=9 < embl-56.hl.humrod | grep -v different > embl-56.hl.humrod.donors-2.9

gawk -f Dsites-2.awk embl-56.hl.humrod.donors-2.9 > embl-56.hl.humrod.donors-2.9.sim

Compute average number of conserved residues per site
gawk '{sum+=$4}END{print sum/NR}' embl-56.hl.humrod.donors-2.9.sim   
7.725 86%

Now do the same for 9 bases upstream and 9 bases downstream the
donor site.


-- 9up

ExtractSites embl-56.hl.humrod.cds embl-56.hl.humrod.tbl ff=2 fs=2 off=-11 len=9 < embl-56.hl.humrod | grep -v different > embl-56.hl.humrod.donors-11.9

gawk -f Dsites-2.awk embl-56.hl.humrod.donors-11.9 > embl-56.hl.humrod.donors-11.9.sim

Compute average number of conserved residues per site
gawk '{sum+=$4}END{print sum/NR}' embl-56.hl.humrod.donors-11.9.sim   
7.255 81%

Now do the same for 9 bases upstream and 9 bases downstream the
donor site.


-- 9down

ExtractSites embl-56.hl.humrod.cds embl-56.hl.humrod.tbl ff=2 fs=2 off=7 len=9 < embl-56.hl.humrod | grep -v different > embl-56.hl.humrod.donors+7.9

gawk -f Dsites-2.awk embl-56.hl.humrod.donors+7.9 > embl-56.hl.humrod.donors+7.9.sim

Compute average number of conserved residues per site
gawk '{sum+=$4}END{print sum/NR}' embl-56.hl.humrod.donors+7.9.sim   

4.333 48%

2. acceptors
ExtractSites embl-56.hl.humrod.cds embl-56.hl.humrod.tbl ff=3 fs=2 off=-16 len=17 < embl-56.hl.humrod | grep -v different > embl-56.hl.humrod.acceptors-16.17


gawk -f Dsites-2.awk embl-56.hl.humrod.acceptors-16.17 > embl-56.hl.humrod.acceptors-16.17.sim

gawk '{sum+=$4}END{print sum/NR}' embl-56.hl.humrod.acceptors-16.17.sim

10.3922  61%


-- 17up

ExtractSites embl-56.hl.humrod.cds embl-56.hl.humrod.tbl ff=3 fs=2 off=-33 len=17 < embl-56.hl.humrod | grep -v different > embl-56.hl.humrod.acceptors-33.17


gawk -f Dsites-2.awk embl-56.hl.humrod.acceptors-33.17 > embl-56.hl.humrod.acceptors-33.17.sim

gawk '{sum+=$4}END{print sum/NR}' embl-56.hl.humrod.acceptors-33.17.sim

5.92 35%

-- 17 down 

ExtractSites embl-56.hl.humrod.cds embl-56.hl.humrod.tbl ff=3 fs=2 off=1 len=17 < embl-56.hl.humrod | grep -v different > embl-56.hl.humrod.acceptors+1.17


gawk -f Dsites-2.awk embl-56.hl.humrod.acceptors+1.17 > embl-56.hl.humrod.acceptors+1.17.sim

gawk '{sum+=$4}END{print sum/NR}' embl-56.hl.humrod.acceptors+1.17.sim

14.333 84%

---------------------------------------------------------------

Investigate frequency of changes:

DONORS
gawk -f Dsites-3.awk embl-56.hl.humrod.donors-2.9 | sort +3 -nr > embl-56.hl.humrod.donors-2.9.s1

g a 6 8
a g 6 4
g a 9 3
c t 7 3
c g 9 3
c g 8 3
a g 9 3
t g 9 2
t c 9 2
t a 9 2
g a 2 2
c a 1 2
a t 2 2
a g 7 2
a g 3 2

positional

9 20
6 14
7 7
2 7
8 6
3 6
1 5


ACCEPTORS

porti3 26% gawk -f Dsites-3.awk embl-56.hl.humrod.acceptors-16.17 | sort +3 -nr | head -10
c t 5 16
c t 12 9
c t 11 9
t c 2 8
c t 4 8
c t 14 8
c t 9 7
c t 3 7
c t 10 7
t c 7 6



positional

4 33
5 32
2 30
3 27
7 23
13 23
10 22
1 22
9 21
8 21
6 21
11 21
12 17
14 16
17 7
15 1

------------------------------------------------------------------

Investigate if model of splice site evolution helps identifying
splice sites

first, get a model of change 

gawk -f Dsites-4.awk embl-56.hl.humrod.donors-2.9 > ehhd.wmat

And use it to weight distance between splice sites


sh -vx RunDsites-1.sh Sites Dsites Sites-2 GT.sim ehhd.wmat < embl-56.hl.humrod

The scores distribute between 102 and 288. We substract 188 and divide by
100


sh 2aplot-1.sh Sites-2 GT.sim Aplot-2 GT.sim.gff donors 2 7 <  embl-56.hl.humrod

----------------------------------------------------------

Try to see how good is prediction of splice sites by conservation

mkdir Eval

Do not consider SPEE 

We need to create the score file from the pairwise similarity file

A/ USE PWM Scores
1. We use the PWM score first
Note that cuttoff set to 0.

sh GetScore.sh ../Sites-2 GT.sim < embl-56.hl.humrod-14 | sort > ehrd.pwscr
2603 potential sites over cuttoff

2. Get list of real sites

gawk '{print $1 "_" $2}' ../embl-56.hl.humrod.donors | egrep -v 'HSSPERSYN|MMSPERSYN' | sort > ehrd


99 sites located (out of 101. There is one site gc in ENOB mouse

3. Now get files for SiteEval.sh

egrep -v 'HSSPERSYN|MMSPERSYN' ../embl-56.hl.humrod.locus > embl-56.hl.humrod-14.locus

gawk '{print $1}'  ehrd.pwscr | comm -23 - ehrd > ehrd.no 

SiteEval.sh ehrd ehrd.no embl-56.hl.humrod-14.locus < ehrd.pwscr > pwscr.don.eval

Table.sh 2606 pwscr.don.eval 
	
MFP-0%       MFP-5%      MFP-10%    MFPab MFPav SRank MSRank 1st-%
1027 39.41   880 33.77   705 27.05   534 21.83  1451  32.72 63.64


B/ Frequency of Conservation (simply counts of conserved residues)

sh GetScore.sh ../Sites dist.GT < embl-56.hl.humrod-14 | sort > ehrd.frscr


SiteEval.sh ehrd ehrd.no embl-56.hl.humrod-14.locus < ehrd.frscr > frscr.don.eval
Table.sh 2606 frscr.don.eval
2486 95.40  2234 85.73  2234 85.73  1175 46.29  4331  21.56 18.18


C/ SS Change Model

sh GetScore.sh ../Sites-2 GT.sim < embl-56.hl.humrod-14 | sort > ehrd.chscr

SiteEval.sh ehrd ehrd.no embl-56.hl.humrod-14.locus < ehrd.chscr > chscr.don.eval
Table.sh 2606 chscr.don.eval
959 36.80   787 30.20   540 20.72   446 17.23  1287  42.18 81.82

========================================>

D/
Recompute model as log-likelihood

D.1
sh -vx RunDsites-1.sh ../Sites Dsites Dsites ehrd  ehrd.logmat < embl-56.hl.humrod-14

sh GetScore.sh Dsites ehrd < embl-56.hl.humrod-14 | sort > ehrd.logmat.scr

SiteEval.sh ehrd ehrd.no embl-56.hl.humrod-14.locus < ehrd.logmat.scr > ehrd.logmat.eval

Table.sh 2606 ehrd.logmat.eval
630 24.17   469 18.00   384 14.74   309 12.02  1001  55.97 81.82

D.2 add pseudocounts when 0
gawk -f Dsites-4.3.1.awk ../embl-56.hl.humrod.donors-2.9 > ehrd.logmat.p

sh -vx RunDsites-1.sh ../Sites Dsites Dsites ehrd.logmat.p  ehrd.logmat.p < embl-56.hl.humrod-14

sh GetScore.sh Dsites ehrd.logmat.p < embl-56.hl.humrod-14 | sort > ehrd.logmat.p.scr

SiteEval.sh ehrd ehrd.no embl-56.hl.humrod-14.locus < ehrd.logmat.p.scr > ehrd.logmat.p.eval

Table.sh 2606 ehrd.logmat.p.eval
660 25.33   481 18.46   395 15.16   311 12.10  1004  55.91 81.82

D.3 get observed frequenciess

gawk '{l=length($2); for (i=1;i<=l;i++) {f[substr($2,i,1)]++;n++}}END{for (i in f) print i, f[i]/n}' ../embl-56.hl.humrod.tbl

a 0.230742
c 0.266272
g 0.267812
t 0.235166

gawk -f Dsites-4.3.2.awk ../embl-56.hl.humrod.donors-2.9 > ehrd.logmat.p-2

sh -vx RunDsites-1.sh ../Sites Dsites Dsites ehrd.logmat.p-2  ehrd.logmat.p-2 < embl-56.hl.humrod-14

sh GetScore.sh Dsites ehrd.logmat.p-2 < embl-56.hl.humrod-14 | sort > ehrd.logmat.p-2.scr

SiteEval.sh ehrd ehrd.no embl-56.hl.humrod-14.locus < ehrd.logmat.p-2.scr > ehrd.logmat.p-2.eval

Table.sh 2606 ehrd.logmat.p-2.eval
730 28.01   588 22.56   350 13.43   326 12.68   992  55.76 81.82


D.4 Use now frequencies of observed pairs of nucleotides

from Thomas table

gawk -f subs2sub.awk SubsMatrix-14 | tr 'A-Z' 'a-z' > embl-56.hl.humrod-14.submat

gawk -f Dsites-4.3.3.awk embl-56.hl.humrod-14.submat ../embl-56.hl.humrod.donors-2.9 > ehrd.logmat.p-3


sh RunDsites-1.sh ../Sites Dsites Dsites ehrd.logmat.p-3  ehrd.logmat.p-3 < embl-56.hl.humrod-14

sh GetScore.sh Dsites ehrd.logmat.p-3 < embl-56.hl.humrod-14 | sort > ehrd.logmat.p-3.scr

SiteEval.sh ehrd ehrd.no embl-56.hl.humrod-14.locus < ehrd.logmat.p-3.scr > ehrd.logmat.p-3.eval

Table.sh 2606 ehrd.logmat.p-3.eval
1794 68.84  1493 57.29   834 32.00   617 25.74  1883  28.50 63.64

----
----

 maybe is time to put everything together.



TODO:

1. Use mRNA exons, instead of CDS

2. Compute values for Acceptor Sites

3. Extend to larger Sanger dataset


Goto SpliceSiteConservation-2
